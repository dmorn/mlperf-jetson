<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- NVIDIA customization --><title>NVIDIA Jetson Linux Driver Package Software Features : NVIDIA Hardware Acceleration in the WebRTC Framework | NVIDIA Docs </title><link rel="Prev" href="accelerated_gstreamer.html" title="Previous" /><link rel="Next" href="clock_power_setup.html" title="Next" /><link rel="StyleSheet" href="../css/font-awesome/css/font-awesome.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/hardware_acceleration_in_webrtc.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><noscript><div id="noscript_padding"></div></noscript></head><body id="pZf2YLFh1f9ET_002fkkFUwLV5A" class="ww_skin_page_body" style="visibility: hidden;"><input type="hidden" id="page_onload_url" value="../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/hardware_acceleration_in_webrtc.html"></input><span id="dropdown_ids" style="display:none;"></span><div id="ww_content_container"><header id="wwconnect_header"><div class="ww_skin_page_toolbar"><div id="dropdown_button_container" class="dropdown_container dropdown_button_container_disabled"><a id="show_hide_all" class="ww_skin ww_behavior_dropdown_toggle ww_skin_dropdown_toggle" title="Page DropDown Toggle" href="#"><i class="fa"></i></a><span class="ww_skin_page_toolbar_divider">&nbsp;</span></div><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#"><i class="fa"></i></a></div><!-- was this helpful button --><!--                         --></header><div id="page_content_container" style="background-attachment: scroll; background-image: url(&quot;watermark.png&quot;); background-position: center center; background-repeat: no-repeat; margin-left: 0pt; margin-right: 10pt; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px"><div id="page_content"><H1 id="wwpID0E0SD0HA" class="Heading_1">NVIDIA Hardware Acceleration in the WebRTC Framework</H1><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/hardware_acceleration_in_webrtc.html#wwpID0E0ND0HA">Typical Buffer Flow</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/hardware_acceleration_in_webrtc.html#wwpID0E0ID0HA">Application and Unit Test Setup</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/hardware_acceleration_in_webrtc.html#wwpID0E0NC0HA">Important Method Calls</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/hardware_acceleration_in_webrtc.html#wwpID0E0YB0HA">The WebRTC Package</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/hardware_acceleration_in_webrtc.html#wwpID0E0NB0HA">Limitations</a></div></dd></dl></div><div id="wwpID0E0RD0HA" class="Body_Text">WebRTC is a free open source project that provides real-time communication capabilities to browsers and mobile apps.</div><div class="ww_skin_page_overflow"><div id="wwpID0E0QD0HA" class="Body_Text"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/image4_11.png" style="display: inline; left: 0pt; top: 0pt" alt="A screenshot of a video game Description automatically generated" title="A screenshot of a video game Description automatically generated" /></div></div><div id="wwpID0E0PD0HA" class="Body_Text">A major feature of WebRTC is the ability to send and receive interactive HD videos. Fast processing of such videos requires hardware accelerated video encoding.</div><div id="wwpID0E0OD0HA" class="Body_Text">Currently the open source WebRTC project framework supports various software encoder types: VP8, VP9, and H264. NVIDIA integrates hardware accelerated H.264 encoding into the WebRTC encoding framework. This document uses the name NvEncoder to denote this feature.</div><H2 id="wwpID0E0ND0HA" class="Heading_2">Typical Buffer Flow</H2><div id="wwpID0E0MD0HA" class="Body_Text">The following diagram shows a typical buffer flow in the hardware accelerated WebRTC encoding framework.</div><div class="ww_skin_page_overflow"><div id="wwpID0E0LD0HA" class="Body_Text"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/image5_9.png" style="display: inline; left: 0pt; top: 0pt" alt="A screenshot of a cell phone Description automatically generated" title="A screenshot of a cell phone Description automatically generated" /></div></div><div id="wwpID0E0KD0HA" class="Body_Text">A source delivers YUV frames, which the framework converts to I420 format and queues on the output plane of the encoder. The output plane buffers are sent to NvEncoder using proprietary NVIDIA low-level encoding libraries. NvEncoder returns filled encoded buffers on its capture plane.</div><div id="wwpID0E0JD0HA" class="Body_Text">The encoded buffers are sent for further processing as required by the application.</div><H2 id="wwpID0E0ID0HA" class="Heading_2">Application and Unit Test Setup</H2><div id="wwpID0E0HD0HA" class="Body_Text">A README file in the <span class="Code_Char">WebRTC_r32.2.0_aarch64.tbz2</span> package contains additional information about for application usage and setup.</div><div id="wwpID0E0GD0HA" class="Heading_5">To set up and test the NvEncoder sample application</div><div id="wwpID0E0FD0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span><span class="Strong">Video Loopback application</span>: To run the application, enter this command:</div><div id="wwpID0E0ED0HA" class="Code">$ ./video_loopback --codec H264  --width 1280 --height  720  --capture_device_index 0</div><div id="wwpID0E0DD0HA" class="List_Continue">Where:</div><div id="wwpID0E0CD0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">--codec</span> specifies the encoding format. Hardware encoding currently supports only H.264.</div><div id="wwpID0E0BD0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">--width</span> specifies the frame width.</div><div id="wwpID0E0AD0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">--height</span> specifies the frame height.</div><div id="wwpID0E06C0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">--capture_device_index</span> specifies the index of <span class="Code_Char">/dev/video&lt;x&gt;</span>.</div><div id="wwpID0E05C0HA" class="List_Continue">If the WebRTC framework works correctly, the application displays the camera stream with the desired width and height. It scales if WebRTC detects frame drops.</div><div id="wwpID0E04C0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span><span class="Strong">Peer connection Client/Server application</span>:</div><div id="wwpID0E03C0HA" class="List_Number_2"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span><span class="Strong">Camera setup</span>: Connect a USB camera to the Jetson device.</div><div id="wwpID0E02C0HA" class="List_Continue_2"><span class="Strong">Server setup</span>: To start the <span class="Code_Char">peerconnection_client</span> application on the Jetson platform, enter the command:</div><div id="wwpID0E01C0HA" class="Code_Indent">$ ./peerconnection_server</div><div id="wwpID0E0ZC0HA" class="List_Continue_2">This command starts the server on port 8888 with the default configuration.</div><div id="wwpID0E0YC0HA" class="List_Continue_2"><span class="Strong">Client setup</span>: To start two instances of the peerconnection_client application on the Jetson platform, enter the commands:</div><div id="wwpID0E0XC0HA" class="Code_Indent">$ ./peerconnection_client --autoconnect  --server  &lt;Server.IP&gt;</div><div id="wwpID0E0WC0HA" class="Code_Indent">$ ./peerconnection_client --server &lt;Server.IP&gt; --autoconnect --autocall</div><div id="wwpID0E0VC0HA" class="List_Continue_2">Each command starts an instance that connects a client to the server automatically. The second command uses the <span class="Code_Char">‑‑autocall</span> option to call the first available other client on the server without user intervention.</div><div id="wwpID0E0UC0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>H<span class="Strong">.264 unit test for NvEncoder</span>: Enter the command:</div><div id="wwpID0E0TC0HA" class="Code">$ ./modules_tests --gtest_filter="TestNvH264Impl.*"  --gtest_repeat=&lt;num_of_iterations&gt;</div><div id="wwpID0E0SC0HA" class="List_Continue">If the software on the Jetson device displays an error for pulseaudio:</div><div id="wwpID0E0RC0HA" class="List_Number_2" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Enter this command to install pulseaudio:</div><div id="wwpID0E0QC0HA" class="Code_Indent">$ sudo apt install pulseaudio</div><div id="wwpID0E0PC0HA" class="List_Number_2"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Enter this command to start the pulseaudio daemon:</div><div id="wwpID0E0OC0HA" class="Code_Indent">$ pulseaudio –start</div><H2 id="wwpID0E0NC0HA" class="Heading_2">Important Method Calls</H2><div id="wwpID0E0MC0HA" class="Body_Text"><span class="Code_Char">NvEncoder</span> is based on the <span class="Code_Char">NvVideoEncoderFactory</span> class, defined in the header file:</div><div id="wwpID0E0LC0HA" class="Code">webrtc_headers/modules/video_coding/codecs/nvidia/NvVideoEncoderFactory.h</div><div id="wwpID0E0KC0HA" class="Body_Text">This header file is in the package <span class="Code_Char">WebRTC_r32.2.0_aarch64.tbz2</span>.</div><div id="wwpID0E0JC0HA" class="Body_Text">This section summarizes important calls to <span class="Code_Char">NvEncoder</span>.</div><div id="wwpID0E0IC0HA" class="Heading_5">To create a hardware-enabled video encoder</div><div id="wwpID0E0HC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Execute the method call:</div><div id="wwpID0E0GC0HA" class="Code">std::unique_ptr&lt;VideoEncoder&gt; CreateVideoEncoder(const webrtc::SdpVideoFormat&amp; format)</div><div id="wwpID0E0FC0HA" class="List_Continue">The arguments are:</div><div id="wwpID0E0EC0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">format</span>: Specifies the desired encoding format. Currently only <span class="Code_Char">SdpVideoFormat</span> (H.264) is supported.</div><div id="wwpID0E0DC0HA" class="Body_Text">The method creates and returns an <span class="Code_Char">NvVideoEncoder</span> object for the specified format.</div><div id="wwpID0E0CC0HA" class="Heading_5">To query the video encoder</div><div id="wwpID0E0BC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Execute the function call:</div><div id="wwpID0E0AC0HA" class="Code">CodecInfo QueryVideoEncoder(const SdpVideoFormat&amp; format)</div><div id="wwpID0E06B0HA" class="Body_Text">The arguments are:</div><div id="wwpID0E05B0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">format</span>: Specifies the desired encoding format.</div><div id="wwpID0E04B0HA" class="Body_Text">The function queries the video encoder and returns its codec information.</div><div id="wwpID0E03B0HA" class="Heading_5">To get supported video formats</div><div id="wwpID0E02B0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Execute the method call:</div><div id="wwpID0E01B0HA" class="Code">std::vector&lt;SdpVideoFormat&gt; GetSupportedFormats()</div><div id="wwpID0E0ZB0HA" class="Body_Text">The method returns a vector of SdpVideoFormat objects with all formats supported by the encoder.</div><H2 id="wwpID0E0YB0HA" class="Heading_2">The WebRTC Package</H2><div id="wwpID0E0XB0HA" class="Body_Text">The file <span class="Code_Char">WebRTC_r32.2.0_aarch64.tbz2</span> contains these files:</div><div id="wwpID0E0WB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">libwebrtc.a</span>: A WebRTC library file</div><div id="wwpID0E0VB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Header files: All WebRTC header files with their respective pathnames</div><div id="wwpID0E0UB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">video_loopback</span>: An application to test basic video loopback functionality</div><div id="wwpID0E0TB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">peerconnection_client</span>: A client application that connects to a server and to other clients</div><div id="wwpID0E0SB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">peerconnection_server</span>: An application that creates a server and an interface to clients</div><div id="wwpID0E0RB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">module_test</span>: An encoder unit test application</div><div id="wwpID0E0QB0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">README</span>: A README file for applications and <span class="Code_Char">NvVideoEncoderFactory</span>.</div><div id="wwpID0E0PB0HA" class="Body_Text">The base commit ID for the library is 8f22a28e30b05a4716091f6425d34e537cddcb86.</div><div id="wwpID0E0OB0HA" class="Body_Text">The commit ID corresponds to the OSS WebRTC project used for development. See this link for <span class="Hyperlink"><a href="https://webrtc.org/native-code/development/" target="external_window">instructions to sync the OSS WebRTC project</a></span>:</div><H2 id="wwpID0E0NB0HA" class="Heading_2">Limitations</H2><div id="wwpID0E0MB0HA" class="Body_Text">Currently hardware acceleration supports only the H.264 encoder.</div><div id="wwpID0E0LB0HA" class="Body_Text">The <span class="Code_Char">video_loopback</span> works only with the H.264 encoder.</div><div id="wwpID0E0KB0HA" class="Body_Text">USB Camera outputs buffers in YUY2 color format, but <span class="Code_Char">NVEncoder</span> expects input in I420 or NV12  format, requiring a color conversion. This is currently done using the WebRTC framework on the CPU.</div><div id="wwpID0E0JB0HA" class="Normal">&nbsp;</div><div id="wwpID0E0IB0HA" class="Normal">&nbsp;</div><div id="wwpID0E0HB0HA" class="Normal">&nbsp;</div><div id="wwpID0E0GB0HA" class="Normal">&nbsp;</div><div id="wwpID0E0FB0HA" class="Normal">&nbsp;</div><div id="wwpID0E0EB0HA" class="Normal">&nbsp;</div><div id="wwpID0E0DB0HA" class="Normal">&nbsp;</div><div id="wwpID0E0CB0HA" class="Normal">&nbsp;</div><div id="wwpID0E0BB0HA" class="Normal">&nbsp;</div><div id="wwpID0E0AB0HA" class="Normal">&nbsp;</div><div id="wwpID0E6HA" class="Normal">&nbsp;</div><div id="wwpID0E5HA" class="Normal">&nbsp;</div><div id="wwpID0E4HA" class="Normal">&nbsp;</div><div id="wwpID0E3HA" class="Normal">&nbsp;</div><div id="wwpID0E2HA" class="Normal">&nbsp;</div><div id="wwpID0E1HA" class="Normal">&nbsp;</div><div id="wwpID0EZHA" class="Normal">&nbsp;</div><div id="wwpID0EYHA" class="Normal">&nbsp;</div><div id="wwpID0EXHA" class="Normal">&nbsp;</div><div id="wwpID0EWHA" class="Normal">&nbsp;</div><div id="wwpID0EVHA" class="Normal">&nbsp;</div><div id="wwpID0EUHA" class="Normal">&nbsp;</div><div id="wwpID0ETHA" class="Normal">&nbsp;</div><div id="wwpID0ESHA" class="Normal">&nbsp;</div><div id="wwpID0ERHA" class="Normal">&nbsp;</div><div id="wwpID0EQHA" class="Normal">&nbsp;</div><div id="wwpID0EPHA" class="Normal">&nbsp;</div><div id="wwpID0EOHA" class="Normal">&nbsp;</div><div id="wwpID0ENHA" class="Normal">&nbsp;</div><div id="wwpID0EMHA" class="Normal">&nbsp;</div><div id="wwpID0ELHA" class="Normal">&nbsp;</div><div id="wwpID0EKHA" class="Normal">&nbsp;</div><div id="wwpID0EJHA" class="Normal">&nbsp;</div><div id="wwpID0EIHA" class="Normal">&nbsp;</div><div id="wwpID0EHHA" class="Normal">&nbsp;</div><div id="wwpID0EGHA" class="Normal">&nbsp;</div><div id="wwpID0EFHA" class="Normal">&nbsp;</div><div id="wwpID0EEHA" class="Normal">		3</div><div id="wwpID0EDHA" class="Normal">&nbsp;</div><div id="wwpID0ECHA" class="Normal">&nbsp;</div><div id="wwpID0EBHA" class="Normal">&nbsp;</div></div><div id="page_dates"></div><!-- Related Topics --><!--                --><footer><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br /></footer></div></div><input type="hidden" id="preserve_unknown_file_links" value="false"></input><noscript><div id="noscript_warning">This site works best with JavaScript enabled</div></noscript><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></body></html>