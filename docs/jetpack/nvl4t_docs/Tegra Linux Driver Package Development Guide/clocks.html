<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- NVIDIA customization --><title>NVIDIA Jetson Linux Driver Package Software Features : Clock Frequency and Power Management | NVIDIA Docs </title><link rel="Prev" href="clock_power_setup.html" title="Previous" /><link rel="Next" href="power_management_nano.html" title="Next" /><link rel="StyleSheet" href="../css/font-awesome/css/font-awesome.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/clocks.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><noscript><div id="noscript_padding"></div></noscript></head><body id="pPfoyO7P2Ke1W0ubwTNawSw" class="ww_skin_page_body" style="visibility: hidden;"><input type="hidden" id="page_onload_url" value="../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html"></input><span id="dropdown_ids" style="display:none;"></span><div id="ww_content_container"><header id="wwconnect_header"><div class="ww_skin_page_toolbar"><div id="dropdown_button_container" class="dropdown_container dropdown_button_container_disabled"><a id="show_hide_all" class="ww_skin ww_behavior_dropdown_toggle ww_skin_dropdown_toggle" title="Page DropDown Toggle" href="#"><i class="fa"></i></a><span class="ww_skin_page_toolbar_divider">&nbsp;</span></div><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#"><i class="fa"></i></a></div><!-- was this helpful button --><!--                         --></header><div id="page_content_container" style="background-attachment: scroll; background-image: url(&quot;watermark.png&quot;); background-position: center center; background-repeat: no-repeat; margin-left: 0pt; margin-right: 10pt; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px"><div id="page_content"><H1 id="wwpID0E0MG0HA" class="Heading_2_Top">Clocks</H1><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html#wwpID0E03F0HA">Overriding Default Clock Rates</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html#wwpID0E0SF0HA">Configuring GPU Clocks</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html#wwpID0E02E0HA">Configuring VIC Clocks</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html#wwpID0E0YE0HA">VIC Dynamic Voltage and Frequency Scaling</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html#wwpID0E0HE0HA">Sysfs Paths for DVFS Control</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html#wwpID0E04B0HA">Configuring Clocks</a></div></dd></dl></div><div id="wwpID0E0LG0HA" class="Body_Text">NVIDIA<span style="vertical-align: super">®</span> Jetson™ Board Support Package (BSP) supports configuring Jetson clocks and peripheral clocks through the software. This topic describes how to check clock status, get maximum rates for clocks, and configure clock sources.</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 36pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 49.5pt"><div id="wwpID0EABA0KG0HA" class="Cell_Heading">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 342pt"><div id="wwpID0EAAA0KG0HA" class="Note_Text">For information about available Jetson clock sources and capabilities, see the “Clock and Reset Controller” section of the <span class="Emphasis">Technical Reference Manual</span> (<span class="Emphasis">TRM</span>) for your Jetson processor. This section of the <span style="font-style: italic">TRM</span> also describes clock source multiplexers and provides descriptions of available clock sources for each component.</div></td></tr></table></div><div id="wwpID0E0JG0HA" class="Body_Text">In kernel 4.9 and following, the common clock framework (CCF) is supported. As a result:</div><div id="wwpID0E0IG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>All device drivers use the public CCF APIs <span class="Code_Char">include/linux/clk.h</span>, and <span class="Code_Char">include/linux/clk-provider.h</span>, including functions such as <span class="Code_Char">clk_get</span>, <span class="Code_Char">clk_enable</span>, <span class="Code_Char">devm_clk_get</span>, <span class="Code_Char">clk_prepare_enable</span>, <span class="Code_Char">clk_prepare_disable</span>, <span class="Code_Char">clk_disable</span>, and others, instead of platform-specific APIs.</div><div id="wwpID0E0HG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>All clock drivers, including the Jetson custom <span class="Code_Char">clk</span> driver, implement <span class="Code_Char">clk_ops</span>.</div><div id="wwpID0E0GG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Clock sources and clocks required by devices are defined in the Device Tree.</div><div id="wwpID0E0FG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Clocks are controlled by an R5 called the Boot and Power Management Processor. It runs RTOS software from <span class="Code_Char">bpmp.bin</span>. The Linux kernel running on CCPLEX requests this software for clock programming.</div><div id="wwpID0E0EG0HA" class="Body_Text">The NVIDIA<span style="vertical-align: super">®</span> Jetson™ Linux Driver Package (L4T) clock driver wrapper is available in the <span class="Code_Char">nvidia/drivers/clk/tegra/</span> directory.</div><div id="wwpID0E0DG0HA" class="Heading_5">To check clock status</div><div id="wwpID0E0CG0HA" class="Body_Text_Indent"><span class="Strong">Applies to</span>: Jetson AGX Xavier series and Jetson TX2 series</div><div id="wwpID0E0BG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>On the device, enter the following command to launch <span class="Code_Char">debugfs</span> and check the clock:</div><div id="wwpID0E0AG0HA" class="Code">sudo -s</div><div id="wwpID0E06F0HA" class="Code"># cat /sys/kernel/debug/bpmp/debug/clk/clk_tree</div><div id="wwpID0E05F0HA" class="Body_Text">This is an example of <span class="Code_Char">debugfs</span> output for NVIDIA<span style="vertical-align: super">®</span> Jetson AGX Xavier™ series:</div><div class="ww_skin_page_overflow"><div id="wwpID0E04F0HA" class="Body_Text"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/image1_5.png" style="display: inline; left: 0pt; top: 0pt" alt="A screenshot of a cell phone Description generated with very high confidence" title="A screenshot of a cell phone Description generated with very high confidence" /></div></div><H3 id="wwpID0E03F0HA" class="Heading_3">Overriding Default Clock Rates</H3><div id="wwpID0E02F0HA" class="Body_Text">The default clock rate of each component is set during boot and updated under control of the driver by requesting BPMP. The <span class="Code_Char">debugfs</span> service provides a way to override the default clock rate and set a fixed clock rate. Use <span class="Code_Char">debugfs</span> for debugging and experimental purposes only.</div><div id="wwpID0E01F0HA" class="Body_Text">You can find the child nodes shown below under each clock node. You can use them to change the nodes’ parent and rates. For example:</div><div id="wwpID0E0ZF0HA" class="Code">root@jetson-0422818069479:/sys/kernel/debug/bpmp/debug/clk/can1# ls</div><div id="wwpID0E0YF0HA" class="Code">&nbsp;</div><div id="wwpID0E0XF0HA" class="Code">all               children                   dvfs<br />flags             fmon              hz    _           off<br />max_rate          min_rate          mrq_rate_locked   parent<br />possible_parents  pto_counter       rate              state<br />vdd_aon</div><div id="wwpID0E0WF0HA" class="Body_Text">The Jetson AGX Xavier clocks are controlled by BPMP. For example, override the EMC rate with the following commands:</div><div id="wwpID0E0VF0HA" class="Code-bg">echo 1 &gt; /sys/kernel/debug/bpmp/debug/clk/emc/mrq_rate_locked</div><div id="wwpID0E0UF0HA" class="Code-bg">echo 1 &gt; /sys/kernel/debug/bpmp/debug/clk/emc/state</div><div id="wwpID0E0TF0HA" class="Code-bg">echo x &gt; /sys/kernel/debug/bpmp/debug/clk/emc/rate</div><H3 id="wwpID0E0SF0HA" class="Heading_3">Configuring GPU Clocks</H3><div id="wwpID0E0RF0HA" class="Body_Text">With GPU DVFS enabled using the devfreq framework, GPU frequency changes based on load. You can instead run the GPU at a fixed frequency if necessary.</div><div id="wwpID0E0QF0HA" class="Heading_5">To run the GPU at a fixed frequency</div><div id="wwpID0E0PF0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Enter the following command.</div><div id="wwpID0E0OF0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For gp10b:</div><div id="wwpID0E0NF0HA" class="Code_Indent"># cd  /sys/devices/17000000.gp10b/devfreq/17000000.gp10b/</div><div id="wwpID0E0MF0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For gv11b:</div><div id="wwpID0E0LF0HA" class="Code_Indent"># cd  /sys/devices/gpu.0/devfreq/17000000.gv11b/</div><div id="wwpID0E0KF0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>List the available frequencies:</div><div id="wwpID0E0JF0HA" class="Code">$ cat available_frequencies</div><div id="wwpID0E0IF0HA" class="List_Continue">The command displays a list of available frequencies like this:</div><div id="wwpID0E0HF0HA" class="Code">114750000 216750000 318750000 420750000 522750000 624750000 675750000 828750000 905250000 1032750000 1198500000 1236750000 1338750000 1377000000</div><div id="wwpID0E0GF0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Fix the frequency.</div><div id="wwpID0E0FF0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>To fix the frequency at maximum supported frequency:</div><div id="wwpID0E0EF0HA" class="Code_Indent">echo &lt;max&gt; min_freq</div><div id="wwpID0E0DF0HA" class="List_Continue_2">Where <span class="Code_Char">&lt;max&gt;</span> in the maximum supported frequency. For example, to fix the frequency at the maximum supported frequency from the list in step&nbsp;<a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html#wwpID0E0KF0HA" title="Clocks">2</a>:</div><div id="wwpID0E0CF0HA" class="Code_Indent">echo 1377000000&gt; min_freq</div><div id="wwpID0E0BF0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>To fix any other supported frequency:</div><div id="wwpID0E0AF0HA" class="Code_Indent">echo &lt;freq&gt; &gt; min_freq</div><div id="wwpID0E06E0HA" class="Code_Indent">echo &lt;freq&gt; &gt; max_freq</div><div id="wwpID0E05E0HA" class="List_Continue_2">Where <span class="Code_Char">&lt;freq&gt;</span> in the desired supported frequency. For example, to fix the frequency at 828750000:</div><div id="wwpID0E04E0HA" class="Code_Indent">echo 828750000 &gt; min_freq</div><div id="wwpID0E03E0HA" class="Code_Indent">echo 828750000 &gt; max_freq</div><H3 id="wwpID0E02E0HA" class="Heading_3">Configuring VIC Clocks</H3><div id="wwpID0E01E0HA" class="Body_Text"><span class="Strong">Video Image Compositor</span> (VIC) provides a set of video processing services, including geometry transform processing for lens distortion correction and temporal noise reduction, The VIC voltage and frequency are dynamically scaled to conserve power, based on utilization as measured by the <span class="Strong">activity monitor</span> (actmon).</div><div id="wwpID0E0ZE0HA" class="Body_Text">For more information about VIC, the “Video Image Compositor” section in the Technical Reference Manual (TRM) for your Jetson processor.</div><H4 id="wwpID0E0YE0HA" class="Heading_4">VIC Dynamic Voltage and Frequency Scaling</H4><div id="wwpID0E0XE0HA" class="Body_Text"><span class="Strong">VIC actmon</span> is a hardware block which monitors VIC active cycles in a fixed time window. It works with the <span class="Code_Char">wmark_active</span> devfreq governor to perform <span class="Strong">dynamic voltage and frequency scaling</span> (DVFS) operations for VIC.</div><div id="wwpID0E0WE0HA" class="Body_Text"><span class="Code_Char">wmark_active</span> tries to keep the <span class="Strong">current load </span>(the ratio of VIC&nbsp;active&nbsp;cycle&nbsp;to total&nbsp;cycle, scaled to [0,&nbsp;1000]) within a certain percentage range. It sets upper and lower bounds for the current load. When current load goes outside these bounds, VIC actmon raises an interrupt which causes <span class="Code_Char">wmark_active</span> to raise the VIC frequency, reducing the current load, or lower the frequency, increasing it.</div><div id="wwpID0E0VE0HA" class="Body_Text">The control logic in <span class="Code_Char">wmark_active</span> is:</div><div class="ww_skin_page_overflow"><div id="wwpID0E0UE0HA" class="Body_Text_Indent"><img class="Equation" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/clocks.1.2.jpg" width="100%" style="display: inline; left: 0pt; max-height: 37px; max-width: 384px; top: 0pt" alt="" title="" /> </div></div><div class="ww_skin_page_overflow"><div id="wwpID0E0TE0HA" class="Body_Text_Indent">if (<span class="Emphasis">freq_boost_en</span><span style="color: #00B050"> </span>&amp;&amp; <span class="Emphasis">curr_load</span> &gt;= <span class="Emphasis">load_max</span>)<br />    <img class="Equation" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/clocks.1.3.jpg" width="100%" style="display: inline; left: 0pt; max-height: 18px; max-width: 157px; top: 0pt" alt="" title="" />;<br />else<br />    <img class="Equation" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/clocks.1.4.jpg" width="100%" style="display: inline; left: 0pt; max-height: 37px; max-width: 285px; top: 0pt" alt="" title="" />;</div></div><div class="ww_skin_page_overflow"><div id="wwpID0E0SE0HA" class="Body_Text_Indent"><img class="Equation" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/clocks.1.5.jpg" width="100%" style="display: inline; left: 0pt; max-height: 34px; max-width: 661px; top: 0pt" alt="" title="" /> </div></div><div id="wwpID0E0RE0HA" class="Body_Text_Indent">Select the first available frequency step which is greater than or equal to <span class="Emphasis">avg_target_freq</span><span class="Emphasis">current</span>.</div><div id="wwpID0E0QE0HA" class="Body_Text">Where:</div><div id="wwpID0E0PE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">curr_load</span> is the current load.</div><div id="wwpID0E0OE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">freq_boost_en</span> is a knob which enables or disables the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html#wwpID0E0BD0HA" title="Clocks">frequency boost feature</a></span>.</div><div id="wwpID0E0NE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">F</span><span class="Emphasis">max</span> is the maximum possible VIC frequency.</div><div id="wwpID0E0ME0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">load_max</span> is the <span class="Strong">frequency boost threshold</span>. Its range is [0,&nbsp;1000]. <span class="Code_Char">wmark_active</span> boosts the VIC frequency to <span class="Emphasis">F</span><span class="Emphasis">max</span> when <span class="Emphasis">load_level</span> exceeds this threshold. </div><div id="wwpID0E0LE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">load_target</span> (the <span class="Strong">load target</span>) is the value of <span style="font-style: italic">curr_load</span> that <span class="Code_Char">wmark_active</span> tries to maintain.</div><div id="wwpID0E0KE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">curr_freq</span> is the current VIC frequency, in Hertz.</div><div id="wwpID0E0JE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">curr_ideal_freq</span> is the VIC frequency, in Hertz, that would yield a <span class="Emphasis">curr_load</span> value of <span class="Emphasis">load_target</span> under current instantaneous operating conditions.</div><div id="wwpID0E0IE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">avg_target_freq</span> is the moving average of the target frequency, in Hertz. It is used to avoid abrupt changes in <span style="font-style: italic">curr_freq</span> when it is recalculated. This property is described more fully in <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html#wwpID0E0JD0HA" title="Clocks">To customize VIC DVFS with control knobs</a></span>.</div><H4 id="wwpID0E0HE0HA" class="Heading_4">Sysfs Paths for DVFS Control</H4><div id="wwpID0E0GE0HA" class="Body_Text">This section describes the use of several knobs that control the operation of VIC DVFS.</div><div id="wwpID0E0FE0HA" class="Heading_5">Pathnames of Sysfs Nodes for DVFS Control</div><div id="wwpID0E0EE0HA" class="Body_Text">The sysfs nodes that control VIC knobs are located in a pair of directories whose locations are platform-dependent. The descriptions that follow use these placeholders to represent those directories:</div><div id="wwpID0E0DE0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For NVIDIA Jetson Xavier™ NX, Jetson AGX Xavier series, and Jetson TX2 series:</div><div id="wwpID0E0CE0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">&lt;knobpath&gt;</span> represents:</div><div id="wwpID0E0BE0HA" class="Code_Indent">/sys/devices/13e10000.host1x/15340000.vic/</div><div id="wwpID0E0AE0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">&lt;knobpath_devfreq&gt;</span> represents:</div><div id="wwpID0E06D0HA" class="Code_Indent">/sys/devices/13e10000.host1x/15340000.vic/devfreq/15340000.vic/</div><div id="wwpID0E05D0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>For NVIDIA<span style="vertical-align: super">®</span> Jetson Nano™ devices and Jetson™ TX1:</div><div id="wwpID0E04D0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">&lt;knobpath&gt;</span> represents:</div><div id="wwpID0E03D0HA" class="Code_Indent">/sys/devices/50000000.host1x/54340000.vic/</div><div id="wwpID0E02D0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">&lt;knobpath_devfreq&gt;</span> represents:</div><div id="wwpID0E01D0HA" class="Code_Indent">/sys/devices/50000000.host1x/54340000.vic/devfreq/54340000.vic/</div><div id="wwpID0E0ZD0HA" class="Body_Text">In the following procedures, replace these placeholders with the appropriate pathnames for your Jetson platform.</div><div id="wwpID0E0YD0HA" class="Heading_5">VIC DVFS Control Terminology</div><div id="wwpID0E0XD0HA" class="Body_Text">Many of the control knobs concern the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html#wwpID0E0WE0HA" title="Clocks">current load</a></span> and the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/clocks.html#wwpID0E0LE0HA" title="Clocks">load target</a></span>. The default load target is 700, i.e. <span class="Code_Char">wmark_active</span> tries to keep the VIC active cycle at 70% of the current VIC frequency.</div><div id="wwpID0E0WD0HA" class="Body_Text">A lower load target makes VIC frequency scaling more aggressive, because the VIC frequency scales up to <span class="Emphasis">F</span><span class="Emphasis">max</span> when the VIC active cycle exceeds (load&nbsp;target /&nbsp;1000) × <span class="Emphasis">F</span><span class="Emphasis">max</span>.</div><div id="wwpID0E0VD0HA" class="Heading_5">To enable or disable VIC DVFS</div><div id="wwpID0E0UD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>To enable or disable VIC DVFS, enter the command:</div><div id="wwpID0E0TD0HA" class="Code">$ echo &lt;gov&gt; &gt; &lt;knobpath_devfreq&gt;/governor </div><div id="wwpID0E0SD0HA" class="List_Continue">Where <span class="Code_Char">&lt;gov&gt;</span> is the name of the VIC devfreq governor to be used:</div><div id="wwpID0E0RD0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>To enable VIC DVFS, <span class="Code_Char">wmark_active</span></div><div id="wwpID0E0QD0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span style="font-family: &quot;Palatino Linotype&quot;">•	</span></span>To disable VIC DVFS, <span class="Code_Char">userspace</span></div><div id="wwpID0E0PD0HA" class="List_Continue">VIC DVFS is enabled by default.</div><div id="wwpID0E0OD0HA" class="List_Continue">For example:</div><div id="wwpID0E0ND0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>To disable VIC DVFS on a Jetson Xavier NX platform, enter:</div><div id="wwpID0E0MD0HA" class="Code_Indent">$ echo userspace &gt; /sys/devices/13e10000.host1x/15340000.vic/devfreq/15340000.vic/governor</div><div id="wwpID0E0LD0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>To enable VIC DVFS on a Jetson Nano platform, enter:</div><div id="wwpID0E0KD0HA" class="Code_Indent">$ echo wmark_active &gt; /sys/devices/50000000.host1x/54340000.vic/devfreq/54340000.vic/governor</div><div id="wwpID0E0JD0HA" class="Heading_5">To customize VIC DVFS with control knobs</div><div id="wwpID0E0ID0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>The <span class="Code_Char">block_window</span> control knob defines the shortest period between VIC frequency scaling operations, in microseconds. VIC actmon skips frequency scaling if the last VIC frequency scaling operation was performed less than <span class="Code_Char">block_window</span> microseconds ago.</div><div id="wwpID0E0HD0HA" class="List_Continue">To set <span class="Code_Char">block_window</span>, enter the command:</div><div id="wwpID0E0GD0HA" class="Code">$ echo &lt;period&gt; &gt; &lt;knobpath&gt;/block_window</div><div id="wwpID0E0FD0HA" class="List_Continue">Where <span class="Code_Char">&lt;period&gt;</span> is the <span class="Code_Char">block_window</span> value to set.</div><div id="wwpID0E0ED0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>The <span class="Code_Char">load_target</span> control knob sets the VIC load target. To set <span class="Code_Char">load_target</span>, enter the command:</div><div id="wwpID0E0DD0HA" class="Code">$ echo &lt;target&gt; &gt; &lt;knobpath&gt;/load_target</div><div id="wwpID0E0CD0HA" class="List_Continue">Where <span class="Code_Char">&lt;target&gt;</span> is the load target to set.</div><div id="wwpID0E0BD0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>The <span class="Code_Char">freq_boost_en</span> control knob enables or disables the <span class="Strong">frequency boost</span> feature. If frequency boost is enabled, <span class="Code_Char">wmark_active</span> boosts the VIC frequency to <span class="Emphasis">F</span><span class="Emphasis">max</span> when the VIC load level exceeds the frequency boost threshold (set by the <span class="Code_Char">load_max</span> control knob, below).</div><div id="wwpID0E0AD0HA" class="List_Continue">To enable or disable frequency boost, enter the command:</div><div id="wwpID0E06C0HA" class="Code">$ echo &lt;b&gt; &gt; &lt;knobpath&gt;/freq_boost_en</div><div id="wwpID0E05C0HA" class="List_Continue">Where <span class="Code_Char">&lt;b&gt;</span> is 1 to enable frequency boost, or 0 to disable it.</div><div id="wwpID0E03C0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>The <span class="Code_Char">load_max</span> control knob sets the <span class="Strong">frequency boost threshold</span>. <span class="Code_Char">wmark_active</span> boosts the VIC frequency to <span class="Emphasis">F</span><span class="Emphasis">max</span> when the VIC load level exceeds the frequency boost threshold. Its range is [0,&nbsp;1000]. Its default value is 900.</div><div id="wwpID0E02C0HA" class="List_Continue">Note that <span class="Code_Char">wmark_active</span> boosts the VIC frequency only if <span class="Code_Char">freq_boost_en</span> (above) is enabled.</div><div id="wwpID0E01C0HA" class="List_Continue">To set the frequency boost threshold, enter the command:</div><div id="wwpID0E0ZC0HA" class="Code">$ echo &lt;max&gt; &gt; &lt;knobpath&gt;/load_max</div><div id="wwpID0E0YC0HA" class="List_Continue">Where <span class="Code_Char">&lt;max&gt;</span> is the frequency boost threshold to set.</div><div id="wwpID0E0XC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">curr_ideal_freq</span> is the VIC frequency, in Hertz, that would yield a <span class="Emphasis">curr_load</span> value of <span class="Emphasis">load_target</span> under current instantaneous operating conditions.</div><div id="wwpID0E0WC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Emphasis">avg_target_freq</span> is the average target frequency, in Hertz. That is, it is a moving average of the target frequency, in Hertz.</div><div id="wwpID0E0VC0HA" class="List_Continue">The <span class="Code_Char">smooth</span> knob adjusts the weights that <span class="Emphasis">avg_target_freq</span><span class="Emphasis">previous</span> and <span class="Emphasis">curr_ideal_freq</span> are given in adjusting the value of <span class="Emphasis">avg_target_freq</span> toward the target frequency.</div><div class="ww_skin_page_overflow"><div id="wwpID0E0UC0HA" class="List_Continue"><img class="Equation" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/clocks.1.6.jpg" width="100%" style="display: inline; left: 0pt; max-height: 34px; max-width: 649px; top: 0pt" alt="" title="" /> </div></div><div id="wwpID0E0TC0HA" class="List_Continue">If <span class="Code_Char">smooth</span> is 0, the weight of <span class="Emphasis">avg_target_freq</span><span class="Emphasis">previous</span> is 0% and the weight of <span class="Emphasis">curr_ideal_freq</span> is 100%, so <span class="Emphasis">avg_target_freq</span><span class="Emphasis">current</span> is set to <span class="Emphasis">curr_ideal_freq</span> each time it is adjusted.</div><div id="wwpID0E0SC0HA" class="List_Continue">To set <span class="Code_Char">smooth</span>, enter the command:</div><div id="wwpID0E0RC0HA" class="Code">$ echo &lt;value&gt; &gt; &lt;knobpath&gt;/smooth</div><div id="wwpID0E0QC0HA" class="List_Continue">Where <span class="Code_Char">&lt;value&gt;</span> is the value to set.</div><div id="wwpID0E0PC0HA" class="Heading_5">To set the static VIC frequency</div><div id="wwpID0E0OC0HA" class="Body_Text">For debugging or power/performance evaluation, you may want to set the VIC frequency to a fixed value. You can set the <span class="Strong">static VIC frequency</span> directly if you disable VIC DVFS.</div><div id="wwpID0E0NC0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Disable VIC runtime PM (power management) suspend. This forces the VIC hardware block into a power-on state so that you can configure the VIC frequency with commands:</div><div id="wwpID0E0MC0HA" class="Code">$ echo on &gt; &lt;knobpath&gt;/power/control</div><div id="wwpID0E0LC0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Read the runtime status.</div><div id="wwpID0E0KC0HA" class="Code">$ cat &lt;knobpath&gt;/power/runtime_status</div><div id="wwpID0E0JC0HA" class="List_Continue">The command should display a runtime status of <span class="Code_Char">active</span>.</div><div id="wwpID0E0IC0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Disable VIC DVFS:</div><div id="wwpID0E0HC0HA" class="Code">$ echo userspace &gt; &lt;knobpath_devfreq&gt;/governor</div><div id="wwpID0E0GC0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>Check the available VIC frequency settings:</div><div id="wwpID0E0FC0HA" class="Code">$ cat &lt;knobpath_devfreq&gt;/available_frequencies</div><div id="wwpID0E0EC0HA" class="List_Continue">The command lists the available frequencies like this:</div><div id="wwpID0E0DC0HA" class="Code">115200000 268800000 409600000 550400000 691200000 844800000 985600000 1036800000</div><div id="wwpID0E0CC0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>5.	</span></span>Choose one of the available frequencies, and set the VIC maximum frequency and the VIC frequency to that value:</div><div id="wwpID0E0BC0HA" class="Code">$ echo &lt;frequency&gt; &gt; &lt;knobpath_devfreq&gt;/max_freq</div><div id="wwpID0E0AC0HA" class="Code">$ echo &lt;frequency&gt; &gt; &lt;knobpath_devfreq&gt;/userspace/set_freq</div><div id="wwpID0E06B0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>6.	</span></span>Enable VIC runtime PM suspend:</div><div id="wwpID0E05B0HA" class="Code">$ echo auto &gt; &lt;knobpath&gt;/power/control</div><H3 id="wwpID0E04B0HA" class="Heading_3">Configuring Clocks</H3><div id="wwpID0E03B0HA" class="Body_Text">In general, each block or module has a dedicated clock source register. For detailed information about a given register, see <span class="Code_Char">CLK_RST_CONTROLLER_CLK_SOURCE_&lt;module_name&gt;</span> in the <span class="Emphasis">Technical Reference Manual</span> (<span class="Emphasis">TRM</span>).</div><div id="wwpID0E02B0HA" class="Body_Text">Clock source registers provide clock source selection and clock divider control for the module. The divider is typically 8 bits, 7 integer bits and 1 fractional bit (U7.1).</div><div id="wwpID0E01B0HA" class="Heading_5">To change clock configurations in the kernel device driver module</div><div id="wwpID0E0ZB0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Declare clocks in Device Tree. For example, for <span class="Code_Char">padctl-uphy</span>, clocks can be declared as follows:</div><div id="wwpID0E0YB0HA" class="Code">clocks = &lt;&amp;tegra_car TEGRA210_CLK_HSIC_TRK&gt;,</div><div id="wwpID0E0XB0HA" class="Code">         &lt;&amp;tegra_car TEGRA210_CLK_USB2_TRK&gt;,</div><div id="wwpID0E0WB0HA" class="Code">          &lt;&amp;tegra_car TEGRA210_CLK_PLL_E&gt;;</div><div id="wwpID0E0VB0HA" class="Code">clock-names = "hsic_trk", "usb2_trk", "pll_e";</div><div id="wwpID0E0UB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Use the <span class="Code_Char">devm_clk_get </span>function to obtain the desired clock source using clock-names.</div><div id="wwpID0E0TB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Use the <span class="Code_Char">clk_get_parent</span> function to obtain the parent clock for the desired clock.</div><div id="wwpID0E0SB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>Use the <span class="Code_Char">clk_set_parent</span> function to select the specified clock source for the target clock.</div><div id="wwpID0E0RB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>5.	</span></span>Use the <span class="Code_Char">clk_set_rate</span> function to set the frequency of the target clock. </div><div id="wwpID0E0QB0HA" class="List_Continue">The divider is calculated automatically according to the target rate. Successful clock frequency settings must meet the available divider of that module and the frequency of the clock source.</div><div id="wwpID0E0PB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>6.	</span></span>Use the <span class="Code_Char">clk_round_rate</span> function to get the exact clock frequency that can be configured from the current clock source.</div><div id="wwpID0E0OB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>7.	</span></span>Use <span class="Code_Char">clk_prepare_enable</span> (or <span class="Code_Char">clk_prepare</span> and <span class="Code_Char">clk_enable</span>) functions to ungate/enable the clock. The <span class="Code_Char">clk_prepare</span> function can be used instead of <span class="Code_Char">clk_enable</span> to ungate a clock if the operation may sleep.</div><div id="wwpID0E0NB0HA" class="Heading_5">To use PLLAON as clock source</div><div id="wwpID0E0MB0HA" class="Body_Text_Indent"><span class="Strong">Applies to</span>: Jetson Xavier NX and Jetson AGX Xavier only</div><div id="wwpID0E0LB0HA" class="Body_Text">By default, the PLLAON clock is disabled on T194 L4T platforms to conserve power.</div><div id="wwpID0E0KB0HA" class="Body_Text">You may want to enable PLLAON to achieve a higher clock rate or more accuracy in certain use cases like CAN and PWM. You can do this by first adding PLLAON as a possible parent of a clock, then setting the parent of the clock to PLLAON. </div><div id="wwpID0E0JB0HA" class="Body_Text">You make these changes by modifying the BPMPFW DTB and kernel DTB files. The BPMPFW DTB holds the configuration for clocks; the kernel DTB contains the setting that enables and disables PLLAON.</div><div id="wwpID0E0IB0HA" class="Body_Text">Taking the CAN use case as an example, follow these steps to add PLLAON as a possible parent:</div><div id="wwpID0E0HB0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Convert the BPMPFW DTB (e.g. <span class="Code_Char">tegra194-a02-bpmp-p2888-a04.dtb</span>) to a DTS using the <span class="Code_Char">dtc</span> tool.</div><div id="wwpID0E0GB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Edit the DTS file to add the PLLAON clock ID to the list of possible parents.</div><div id="wwpID0E0FB0HA" class="List_Continue">In the DTS file under <span class="Code_Char">clocks</span>, add the clock ID for PLLAON (symbol <span class="Code_Char">CLK_PLLAON</span>, decimal <span class="Code_Char">94</span>, hex <span class="Code_Char">0x5e</span>),  to the <span class="Code_Char">allowed-parents</span> list:</div><div id="wwpID0E0EB0HA" class="Code">clocks {</div><div id="wwpID0E0DB0HA" class="Code">    clock@can1 {</div><div id="wwpID0E0CB0HA" class="Code">        clk-id = &lt;9&gt;;    /* confirming TEGRA194_CLK_CAN1*/</div><div id="wwpID0E0BB0HA" class="Code">        allowed-parents &lt;nn,nn,nn,...,94&gt;; /*TEGRA194_CLK_PLLAON*/</div><div id="wwpID0E0AB0HA" class="Code">    };</div><div id="wwpID0E6HA" class="Code">    ...</div><div id="wwpID0E5HA" class="Code">};</div><div id="wwpID0E4HA" class="List_Continue">This allows PLLAON to be set as parent of CAN1.</div><div id="wwpID0E3HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Convert the DTS file back to DTB.</div><div id="wwpID0E2HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>Convert the kernel DTB (e.g, <span class="Code_Char">tegra194-p2888-0001-p2822-0000.dtb</span>) to a DTS file using the <span class="Code_Char">dtc</span> tool, or obtain the kernel’s source DTS file.</div><div id="wwpID0E1HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>5.	</span></span>Edit the kernel DTS file to make CAN use PLLAON as parent and remove PLLAON (entry <span class="Code_Char">0x4 0x5e</span>) from the list of clocks to be disabled:</div><div id="wwpID0EZHA" class="Code">clocks-init{</div><div id="wwpID0EYHA" class="Code">    compatible = "nvidia,clocks-config";</div><div id="wwpID0EXHA" class="Code">    disable {</div><div id="wwpID0EWHA" class="Code">        /* Edit clocks property to remove clock provider + clock id pair for PLLAON. */</div><div id="wwpID0EVHA" class="Code">        clocks = &lt;nn nn, nn nn,...&gt;;</div><div id="wwpID0EUHA" class="Code">    };</div><div id="wwpID0ETHA" class="Code">};</div><div id="wwpID0ESHA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>6.	</span></span>To change the <span class="Code_Char">mttcan</span> node to select <span class="Code_Char">PLLAON</span> as parent, add <span class="Code_Char">"pllaon"</span> to the list in <span class="Code_Char">clock-names</span>, and add an entry for <span class="Code_Char">0x4</span> <span class="Code_Char">0x5e</span> to the list in <span class="Code_Char">clocks</span>:</div><div id="wwpID0ERHA" class="Code">mttcan@c310000 {</div><div id="wwpID0EQHA" class="Code">    pll_source = "pllaon";</div><div id="wwpID0EPHA" class="Code">    clocks = &lt;..., 0x4 0x5e&gt;; /*New entry*/</div><div id="wwpID0EOHA" class="Code">    clock-names = &lt;name&gt;, &lt;name&gt;, &lt;name&gt;, ..., "pllaon";</div><div id="wwpID0ENHA" class="Code">};</div><div id="wwpID0EMHA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>7.	</span></span>Convert the DTS file to DTB, or build the kernel DTB if you edited the source files.</div><div id="wwpID0ELHA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>8.	</span></span>Flash the board with the modified DTB files.</div><div id="wwpID0EKHA" class="Heading_5">Clocks that Can Have PLLAON as Parent</div><div id="wwpID0EJHA" class="Body_Text">The following clocks can be configured to have PLLAON as a parent:</div><div id="wwpID0EIHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">TEGRA194_CLK_CAN1</span></div><div id="wwpID0EHHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">TEGRA194_CLK_CAN2</span></div><div id="wwpID0EGHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">TEGRA194_CLK_DMIC5</span></div><div id="wwpID0EFHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">TEGRA194_CLK_I2C2</span></div><div id="wwpID0EEHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">TEGRA194_CLK_I2C8</span></div><div id="wwpID0EDHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">TEGRA194_CLK_PWM4</span></div><div id="wwpID0ECHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">TEGRA194_CLK_SPI2</span></div><div id="wwpID0EBHA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">TEGRA194_CLK_UARTG</span></div></div><div id="page_dates"></div><!-- Related Topics --><!--                --><footer><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br /></footer></div></div><input type="hidden" id="preserve_unknown_file_links" value="false"></input><noscript><div id="noscript_warning">This site works best with JavaScript enabled</div></noscript><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></body></html>