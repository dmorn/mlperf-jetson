<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- NVIDIA customization --><title>NVIDIA Jetson Linux Driver Package Software Features : Jetson Module Adaptation and Bring-Up | NVIDIA Docs </title><link rel="Prev" href="adaptation_and_bringup_tx2.html" title="Previous" /><link rel="Next" href="adaptation_and_bringup_tx1.html" title="Next" /><link rel="StyleSheet" href="../css/font-awesome/css/font-awesome.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/adaptation_and_bringup_tx2_nx.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><noscript><div id="noscript_padding"></div></noscript></head><body id="pwzXQ0gifVCGHwWFDO0BMxQ" class="ww_skin_page_body" style="visibility: hidden;"><input type="hidden" id="page_onload_url" value="../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html"></input><span id="dropdown_ids" style="display:none;"></span><div id="ww_content_container"><header id="wwconnect_header"><div class="ww_skin_page_toolbar"><div id="dropdown_button_container" class="dropdown_container dropdown_button_container_disabled"><a id="show_hide_all" class="ww_skin ww_behavior_dropdown_toggle ww_skin_dropdown_toggle" title="Page DropDown Toggle" href="#"><i class="fa"></i></a><span class="ww_skin_page_toolbar_divider">&nbsp;</span></div><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#"><i class="fa"></i></a></div><!-- was this helpful button --><!--                         --></header><div id="page_content_container" style="background-attachment: scroll; background-image: url(&quot;watermark.png&quot;); background-position: center center; background-repeat: no-repeat; margin-left: 0pt; margin-right: 10pt; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px"><div id="page_content"><H1 id="wwpID0E0TM0HA" class="Heading_2_Top">Jetson TX2 NX Adaptation and Bring-Up</H1><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0PM0HA">Board Configuration</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0LM0HA">Board Naming</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0FM0HA">Root Filesystem Configuration</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E01L0HA">MB1 Configuration Changes</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0WL0HA">Pinmux Changes</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0NL0HA">GPIO Changes</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0XK0HA">PMIC Changes</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0GK0HA">Porting the Linux Kernel</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0VJ0HA">PCIe Controller Configuration</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0SJ0HA">PCIe Controller Features</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0CJ0HA">Porting USB (Universal Serial Bus)</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0AJ0HA">USB Structure</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0WI0HA">Required Device Tree Changes</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0SB0HA">Flashing the Build Image</a></div></dd></dl></div><div id="wwpID0E0SM0HA" class="Body_Text">This topic describes how to port NVIDIA<span style="vertical-align: super">®</span> Jetson™ Linux Driver Package (L4T) from an NVIDIA<span style="vertical-align: super">®</span> Jetson™ TX2 NX module running on a Jetson Xavier NX Developer Kit to a Jetson TX2 NX module on another hardware platform.</div><div id="wwpID0E0RM0HA" class="Body_Text">The examples described include code for NVIDIA<span style="vertical-align: super">®</span> Jetson Xavier™ NX Developer Kit (P3518).</div><div id="wwpID0E0QM0HA" class="Body_Text">For information on customizing the configuration files, see the topic <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/mb1_platform_config_tx2.html#" title="Jetson TX2 Series MB1 Platform Configuration">Jetson TX2 Series MB1 Platform Configuration</a></span>.</div><H3 id="wwpID0E0PM0HA" class="Heading_3">Board Configuration</H3><div id="wwpID0E0OM0HA" class="Body_Text">You can develop products that incorporate the Jetson TX2 NX module (P3636-0010) with a Jetson Xavier NX Developer Kit (P3518). Remove the original Jetson Xavier NX module (P3668-0000) from the developer kit’s Jetson Xavier NX carrier board (P3509-0000) and replace it with a Jetson TX2 NX module. The module and carrier board each have an EEPROM where the board ID is saved. The Jetson module (a <span class="Strong">system on module</span>, or SOM) can be used without any software configuration modifications.</div><div id="wwpID0E0NM0HA" class="Body_Text">The Jetson TX2 NX module has a provision for attaching a heatsink or fansink. The module provided with the Jetson TX2 NX Developer Kit has a fansink already attached. See the <span class="Hyperlink"><a href="https://developer.nvidia.com/embedded/downloads#?search=tx2%20nx%20thermal" target="external_window">Jetson TX2 NX Thermal Design Guide</a></span><span class="Emphasis"> </span>for guidance when designing or procuring a thermal solution for production Jetson Xavier NX modules.</div><div id="wwpID0E0MM0HA" class="Body_Text"><span style="color: #000000">Before using the&nbsp;SOM with a carrier board&nbsp;other than P3509, change the kernel device tree, MB1 configuration, ODM data, and flashing configuration to accommodate the new carrier board instead of P3509. An EEPROM ID for your custom board is not required.</span></div><H3 id="wwpID0E0LM0HA" class="Heading_3">Board Naming</H3><div id="wwpID0E0KM0HA" class="Body_Text">To support a Jetson TX2 NX module with your custom carrier board, you must assign the module/carrier board combination a <span class="Strong">board name</span>. This name must consist of lower case letters, numerals, hyphens, and underscores. You must set the board name in the environment variable <span class="Code_Char">BOARD</span> on your Linux host system.</div><div id="wwpID0E0JM0HA" class="Body_Text">Some examples of valid board names are <span class="Code_Char">p3509-0000+p3668-0000</span>, <span class="Code_Char">p3518-0000-devkit</span>, and <span class="Code_Char">devboard</span>.</div><div id="wwpID0E0IM0HA" class="Body_Text">The installation process uses the board name in filenames and pathnames, including names in the device tree and proc filesystem.</div><div id="wwpID0E0HM0HA" class="Body_Text">The placeholder <span class="Code_Char">&lt;board&gt;</span> is used to represent the board name throughout this topic. Where topic shows a command that contains <span class="Code_Char">&lt;board&gt;</span>, substitute the name of your custom board.</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 49.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 45pt"><div id="wwpID0EABA0GM0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 319.5pt"><div id="wwpID0EAAA0GM0HA" class="Note_Text">Do not modify files whose filenames and pathnames contain your system’s default board name. The default board name refers to the carrier board provided with your Jetson development kit. If it appears in a file’s name, that file contains code or data that is specific to that board. Make copies of such files that are named with your custom board’s board name, and modify them to support your custom board.</div></td></tr></table></div><H3 id="wwpID0E0FM0HA" class="Heading_3">Root Filesystem Configuration</H3><div id="wwpID0E0EM0HA" class="Body_Text">L4T can use any standard or customized Linux root filesystem (rootfs) that is appropriate for their targeted embedded applications.</div><div id="wwpID0E0DM0HA" class="Body_Text">However, certain settings must be configured in the rootfs’s boot-up framework to set default configuration after boot, or some of the core functionalities will not run as expected.</div><div id="wwpID0E0CM0HA" class="Body_Text">For example:</div><div id="wwpID0E0BM0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>The <span class="Code_Char">nv.sh</span> and <span class="Code_Char">nvfb.sh</span> boot-up scripts do some platform-specific configuration in the kernel.</div><div id="wwpID0E0AM0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>The Xorg and X libraries must be correctly configured for the target device.</div><div id="wwpID0E06L0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>The nvpmodel clock and frequency must be configured for the target device.</div><div id="wwpID0E05L0HA" class="Body_Text">These rootfs configurations and customizations are provided in this driver package in the directory and its subdirectories:</div><div id="wwpID0E04L0HA" class="Code">Linux_for_Tegra/nv_tegra/</div><div id="wwpID0E03L0HA" class="Body_Text">You must incorporate the relevant customization for your target rootfs from this location.</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 49.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 49.5pt"><div id="wwpID0EABA02L0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 324pt"><div id="wwpID0EAAA02L0HA" class="Note_Text">For the sample Ubuntu root filesystem provided by NVIDIA, this customization is applied using the script <span class="Code_Char" style="font-size: 10pt">Linux_for_Tegra/apply_binaries.sh</span>.</div></td></tr></table></div><H3 id="wwpID0E01L0HA" class="Heading_3">MB1 Configuration Changes</H3><div id="wwpID0E0ZL0HA" class="Body_Text">Multiple <span class="Code_Char">.cfg</span> files define boot time configuration of the hardware. They are applied by Bootloader. The MB1 boot configuration tables are available at:</div><div id="wwpID0E0YL0HA" class="Code">&lt;l4t_top&gt;/bootloader/t186ref/BCT</div><div id="wwpID0E0XL0HA" class="Body_Text">Where <span class="Code_Char">&lt;l4t_top&gt;</span> is the top-level BSP flashing directory.</div><H4 id="wwpID0E0WL0HA" class="Heading_4">Pinmux Changes</H4><div id="wwpID0E0VL0HA" class="Body_Text">If your board schematic differs from that for Jetson Xavier NX Developer Kit board, you must change the pinmux configuration applied by the software.</div><div id="wwpID0E0UL0HA" class="Body_Text">To define your board’s pinmux configuration, download the <span class="Hyperlink"><a href="https://developer.nvidia.com/embedded/downloads#?search=TX2%20NX%20Series%20Pinmux" target="external_window">Jetson Xavier NX carrier board's pinmux table</a></span> from the Jetson Download Center. Be sure to get the right version of the table for your SOM. The table is a spreadsheet provided to:</div><div id="wwpID0E0TL0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Show the locations and default pinmux settings</div><div id="wwpID0E0SL0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Define the pinmux settings in the source code or device tree</div><div id="wwpID0E0RL0HA" class="Body_Text">You must customize the spreadsheet for the configuration of your board.</div><div id="wwpID0E0QL0HA" class="Body_Text">Once done, you must convert the <span class="Code_Char">.dtsi</span> file generated by Excel to a <span class="Code_Char">.cfg</span>. For instructions, see the README file at:</div><div id="wwpID0E0PL0HA" class="Code">Linux_for_Tegra/kernel/pinmux/t19x/</div><div id="wwpID0E0OL0HA" class="Body_Text">You must perform the same conversion for <span class="Code_Char">gpio.dtsi</span> and <span class="Code_Char">padvoltage.dtsi</span>.</div><H4 id="wwpID0E0NL0HA" class="Heading_4">GPIO Changes</H4><div id="wwpID0E0ML0HA" class="Body_Text">If you designed your own carrier board, to translate from SOM connector pins to actual GPIO numbers you must understand the GPIO mapping formula below. The translated GPIO numbers can be controlled by the driver.</div><div id="wwpID0E0LL0HA" class="Body_Text">For example, to check the GPIO number of signal name <span class="Code_Char">SPI0_CS1</span>, perform the following procedure.</div><div id="wwpID0E0KL0HA" class="Heading_5">To check the GPIO number</div><div id="wwpID0E0JL0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Open the Jetson Xavier NX pinmux table. (See <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0WL0HA" title="Jetson TX2 NX Adaptation and Bring-Up">Pinmux Changes</a></span>, above.)</div><div id="wwpID0E0IL0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Search the table for <span class="Code_Char">SPI0_CS1</span>. </div><div id="wwpID0E0HL0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Confirm that the Customer Usage field contains the GPIO name <span class="Code_Char">GPIO3_PZ.07</span>.</div><div id="wwpID0E0GL0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>Refer to <span class="Code_Char">tegra194-gpio.h</span> to determine the GPIO group that the GPIO belongs to and the <span class="Strong">port index</span> of the GPIO port in the group. The port index is determined by the last letter before the dot in the port name. For example, <span class="Code_Char">GPIO3_PZ.07</span> belongs to the main Jetson GPIO group, and its port index is 25:</div><div id="wwpID0E0FL0HA" class="Code">#define TEGRA_MAIN_GPIO_PORT_Z <span class="Comment_Reference" style="font-family: &quot;Palatino Linotype&quot;">25</span></div><div id="wwpID0E0EL0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>5.	</span></span>Because the Linux kernel assigns GPIO ports dynamically, you must search kernel messages to find the <span class="Strong">base index</span> of each GPIO group, that is, the offset of the first GPIO port assigned to the controller. The command and resulting output are similar to::</div><div id="wwpID0E0DL0HA" class="Code">$ sudo grep tegra-gpio /sys/kernel/debug/gpio</div><div id="wwpID0E0CL0HA" class="Code">gpiochip1: GPIOs 256-319, parent: platform/c2f0000.gpio, tegra-gpio-aon:</div><div id="wwpID0E0BL0HA" class="Code">gpiochip0: GPIOs 320-511, parent: platform/2200000.gpio, tegra-gpio:</div><div id="wwpID0E0AL0HA" class="List_Continue">In this example the output shows that because <span class="Code_Char">GPIO3-PZ.07</span> belongs to the <span class="Code_Char">tegra-gpio</span> group, its base index is 320.</div><div id="wwpID0E06K0HA" class="List_Bullet_3" style="text-indent: 0pt"><span>6.	</span>The last part of the GPIO name indicates the GPIO’s <span class="Strong">pin index</span>, that is the index of the pin within the GPIO port. In this example the pin index of <span class="Code_Char">e</span> is 7.</div><div id="wwpID0E05K0HA" class="List_Number" style="text-indent: 0pt"><span>7.	</span>Use this formula to calculate the GPIO number:</div><div id="wwpID0E04K0HA" class="Code">Linux GPIO number = (base + (8 * port) + pin)</div><div id="wwpID0E03K0HA" class="List_Continue">Where:</div><div id="wwpID0E02K0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">base</span> is the base index the GPIO controller, i.e. the offset of the first GPIO port assigned to the controller by the Linux kernel. In this case it is 320.</div><div id="wwpID0E01K0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">port</span> is the index within the GPIO controller of the Jetson GPIO port that the GPIO belongs to. In this case it is 25.</div><div id="wwpID0E0ZK0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">pin</span> is the index of the pin within the GPIO port. In this case it is 7.</div><div id="wwpID0E0YK0HA" class="List_Continue">Hence, the GPIO number of <span class="Code_Char">SPI0_CS1</span> is 320+(8*25)+7 = 527.</div><H4 id="wwpID0E0XK0HA" class="Heading_4">PMIC Changes</H4><div id="wwpID0E0WK0HA" class="Body_Text">The PMIC configuration file configures the initial PMIC in the P3668 SOM. Some GPIO expander-based GPIO regulator settings in the P3509 carrier board configurations are also defined. Review this configuration file to replace any references to the P3509 carrier board to your custom board. If required, include any regulator information to enable this file.</div><div id="wwpID0E0VK0HA" class="Body_Text">For example, the following settings configure PMIC to turn on SD4 on I2C address 0x3c. The example is from the configuration file <span class="Code_Char">tegra194-mb1-bct-pmic-p3668-0001-a00.cfg</span>.</div><div id="wwpID0E0UK0HA" class="Code">&nbsp;</div><div id="wwpID0E0TK0HA" class="Code">######################## System Configurations ####</div><div id="wwpID0E0SK0HA" class="Code"># PMIC FPS to turn SD4 (VDD_DDR_1V1) on in time slot 0</div><div id="wwpID0E0RK0HA" class="Code"># PMIC FPS to set GPIO2 (EN_DDR_VDDQ)  high in time slot 1</div><div id="wwpID0E0QK0HA" class="Code"># Set SLPEN = 1 and CLRSE on POR reset</div><div id="wwpID0E0PK0HA" class="Code">pmic.system.block[0].type = -1;                    # I2C</div><div id="wwpID0E0OK0HA" class="Code">pmic.system.block[0].controller-id = 4;</div><div id="wwpID0E0NK0HA" class="Code">pmic.system.block[0].slave-add = 0x78;             # 7BIt:0x3c</div><div id="wwpID0E0MK0HA" class="Code">pmic.system.block[0].reg-data-size = 8;</div><div id="wwpID0E0LK0HA" class="Code">pmic.system.block[0].reg-add-size = 8;</div><div id="wwpID0E0KK0HA" class="Code">pmic.system.block[0].block-delay = 10;</div><div id="wwpID0E0JK0HA" class="Code">pmic.system.block[0].commands[0].0x53.0x38 = 0x00; #_SD4 FPS UP slot 0</div><div id="wwpID0E0IK0HA" class="Code">pmic.system.block[0].commands[1].0x55.0x38 = 0x10; #_GPIO2 FPS UP slot 2</div><div id="wwpID0E0HK0HA" class="Code">pmic.system.block[0].commands[2].0x41.0x1C = 0x1C; #_SLPEN=1, CLRSE = 11</div><H3 id="wwpID0E0GK0HA" class="Heading_3">Porting the Linux Kernel</H3><div id="wwpID0E0FK0HA" class="Body_Text">It is assumed that you are using a P3668 SOM connected to a P3509 carrier board which has not been modified; the QSPI, PMIC, and DDR are the same with the same routing of lines. The modifications you are making are for the SOM and the carrier board. Consequently, based on the peripherals present on your carrier board, you can modify the <span class="Code_Char">.dts</span> files by disabling/enabling the controllers and changing the supplies.</div><div id="wwpID0E0EK0HA" class="Body_Text">To port the kernel configuration code (the device tree) to your platform, modify one of the distributed configuration files to describe the design of your platform.</div><div id="wwpID0E0DK0HA" class="Body_Text">The configuration files are available at:</div><div id="wwpID0E0CK0HA" class="Code">&lt;top&gt;/hardware/nvidia/platform/t19x/</div><div id="wwpID0E0BK0HA" class="Code">&lt;top&gt;/hardware/nvidia/soc/t19x</div><div id="wwpID0E0AK0HA" class="Body_Text">The final DTB file used is:</div><div id="wwpID0E06J0HA" class="Code">tegra194-p3668-0000-p3509-0000.dtb</div><div id="wwpID0E05J0HA" class="Body_Text">By reading the above file, you see which other <span class="Code_Char">.dtsi</span> files are referenced by include statements. Common <span class="Code_Char">.dtsi</span> files that may be modified to reflect hardware design changes include:</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 35.75pt" cellspacing="0" summary=""><tr><th style="background-color: #DDEEBF; border-bottom-color: #7F7F7F; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #7F7F7F; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #7F7F7F; border-right-style: solid; border-right-width: 0.75pt; border-top-color: #7F7F7F; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 0pt; padding-left: 0pt; padding-right: 0pt; padding-top: 0pt; vertical-align: bottom; width: 157.5pt"><div id="wwpID0EABG04J0HA" class="Cell_Heading">Types of Changes </div></th><th style="background-color: #DDEEBF; border-bottom-color: #7F7F7F; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #7F7F7F; border-left-style: solid; border-left-width: 0.75pt; border-right-color: #7F7F7F; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #7F7F7F; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 0pt; padding-left: 0pt; padding-right: 0pt; padding-top: 0pt; vertical-align: bottom; width: 243pt"><div id="wwpID0EAAG04J0HA" class="Cell_Heading">DTSI Filename or location</div></th></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABF04J0HA" class="Cell_Text">Power supply changes</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAF04J0HA" class="Cell_Text">tegra194-power-tree-p3668.dtsi</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABE04J0HA" class="Cell_Text">Regulator parameter changes</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAE04J0HA" class="Cell_Text">tegra194-spmic-p3668.dtsi</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABD04J0HA" class="Cell_Text">Display panel and node changes</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAD04J0HA" class="Cell_Text">For details, see the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/display_configuration.html#" title="Display Configuration and Bringup">Display Configuration and Bringup</a></span><span class="Emphasis" style="font-style: normal"> section </span>of the topic <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/kernel_custom.html#" title="Kernel Customization">Kernel Customization</a></span>.</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABC04J0HA" class="Cell_Text">ODM data based feature configuration</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAC04J0HA" class="Cell_Text">tegra194-plugin-manager-p3668.dtsi</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABB04J0HA" class="Cell_Text">NVIDIA SoC controller state to enable/disable a controller</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAB04J0HA" class="Cell_Text">soc/t19x/kernel-dts/tegra194-soc/</div></td></tr><tr><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABA04J0HA" class="Cell_Text">Panels related .dts files</div></td><td style="background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAA04J0HA" class="Cell_Text">platform/tegra/common/kernel-dts/panels/</div></td></tr></table></div><div id="wwpID0E03J0HA" class="Body_Text">Verify that no other <span class="Code_Char">.dts</span> or <span class="Code_Char">.dtsi</span> file, including these <span class="Code_Char">.dts</span> files, overrides any changes you make.</div><div id="wwpID0E02J0HA" class="Body_Text">As a best practice, create your own set of <span class="Code_Char">.dts</span> files based on the Jetson Xavier NX files already present. Rename your newly created files to the name of your board.</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 54pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 49.5pt"><div id="wwpID0EABA01J0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 315pt"><div id="wwpID0EAAA01J0HA" class="Note_Text">Use <span class="Code_Char" style="font-size: 10pt">fdtdump</span> or <span class="Code_Char" style="font-size: 10pt">dtc</span> to generate a <span class="Code_Char" style="font-size: 10pt">.dts</span> from the final <span class="Code_Char" style="font-size: 10pt">.dtb</span> file and check if your changes have taken effect.</div></td></tr></table></div><div id="wwpID0E0YJ0HA" class="Body_Text">The command usage is:</div><div id="wwpID0E0XJ0HA" class="Code">dtc -I dtb -O dts tegra194-p3668-all-p3509-0000.dtb &gt; tegra194-p3668-all-p3509-0000.dts</div><div id="wwpID0E0WJ0HA" class="Code">fdtdump dts tegra194-p3668-all-p3509-0000.dtb &gt; tegra194-p3668-all-p3509-0000.dts</div><H3 id="wwpID0E0VJ0HA" class="Heading_3">PCIe Controller Configuration</H3><div id="wwpID0E0UJ0HA" class="Body_Text">The PCIe host controller is based on Synopsis Designware PCIe intellectual property, and thus inherits all the common properties defined in the information file at:</div><div id="wwpID0E0TJ0HA" class="Code">$(KERNEL_TOP)/nvidia/Documentation/devicetree/bindings/pci/nvidia,tegra19x-pcie.txt</div><H4 id="wwpID0E0SJ0HA" class="Heading_4">PCIe Controller Features</H4><div id="wwpID0E0RJ0HA" class="Body_Text">Jetson TX2 NX has two PCIe controllers with these specifications:</div><div id="wwpID0E0QJ0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Strong">Lane width and speed</span>:</div><div id="wwpID0E0PJ0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>C5: x4 and Gen4</div><div id="wwpID0E0OJ0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>C4: x1 and Gen3</div><div id="wwpID0E0NJ0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Strong">Controllers</span>: Controllers C0, C4 and C5 support dual mode, that is, can be configured as endpoints.</div><div id="wwpID0E0MJ0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Strong">ASPM</span>: All controllers support ASPM.</div><div id="wwpID0E0LJ0HA" class="Body_Text">The Jetson TX2 NX PCIe configuration is:</div><div id="wwpID0E0KJ0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>C5: x4</div><div id="wwpID0E0JJ0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>C4: x1</div><div id="wwpID0E0IJ0HA" class="Body_Text">These PCIe slots available on Jetson TX2 NX:</div><div id="wwpID0E0HJ0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Strong">M.2 Key M</span>: C5 controller operates in x4 mode. Any M.2 Key M form factor NVMe cards can be connected.</div><div id="wwpID0E0GJ0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Strong">M.2 Key E</span>: C4 controller operates in x1 mode. Any M.2 Key E form factor cards like Wi-Fi can be connected.</div><div id="wwpID0E0FJ0HA" class="Body_Text">For information about Jetson TX2 NX-specific PCIe controller configuration, see the device tree documentation file at:</div><div id="wwpID0E0EJ0HA" class="Code">$(KERNEL_TOP)/nvidia/Documentation/devicetree/bindings/pci/nvidia,tegra19x-pcie.txt</div><div id="wwpID0E0DJ0HA" class="Body_Text">This file covers topics that include configuring maximum link speed and link width, and advertisement of different ASPM states.</div><H3 id="wwpID0E0CJ0HA" class="Heading_3">Porting USB (Universal Serial Bus)</H3><div id="wwpID0E0BJ0HA" class="Body_Text">The Jetson TX2 NX can support one enhanced SuperSpeed USB port and up to three High Speed USB ports. The Jetson Xavier NX P3509 carrier board is designed and verified for one USB3.1 port. If you design your own carrier board, verify the compatibility between P3509 and your own board by consulting the NVIDIA team.</div><H4 id="wwpID0E0AJ0HA" class="Heading_4">USB Structure</H4><div id="wwpID0E06I0HA" class="Body_Text">An enhanced SuperSpeed USB port has nine pins:</div><div id="wwpID0E05I0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>VBUS</div><div id="wwpID0E04I0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>GND</div><div id="wwpID0E03I0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>D+</div><div id="wwpID0E02I0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>D−</div><div id="wwpID0E01I0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Two differential signal pairs for SuperSpeed data transfer</div><div id="wwpID0E0ZI0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>One ground (GND_DRAIN) for drain wire termination and managing EMI, RFI, and signal integrity</div><div class="ww_skin_page_overflow"><div id="wwpID0E0YI0HA" class="Body_Text"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/adaptation_and_bringup_tx2_nx.1.1.jpg" style="display: inline; left: 0pt; top: 0pt" alt="" title="" /></div></div><div id="wwpID0E0XI0HA" class="Body_Text">The D+/D− signal pins connect to UTMI pads. The SSTX/SSRX signal pins connect to UPHY and are handled by a single UPHY lane. As UPHY lanes are shared between PCIE, SATA, UFS, and XUSB, UPHY lanes must be assigned according to the custom carrier board’s requirements.</div><H4 id="wwpID0E0WI0HA" class="Heading_4">Required Device Tree Changes</H4><div id="wwpID0E0VI0HA" class="Body_Text">This section gives step-by-step guidance for checking schematics and configuring USB ports in the device tree. All of the examples are based on the design of the Jetson Xavier NX P3509 carrier board.</div><div id="wwpID0E0UI0HA" class="Heading_5">For a Host-Only Port</div><div id="wwpID0E0TI0HA" class="Body_Text">This section uses U7, a USB 3.1 Gen2 Realtek Enhanced SuperSpeed on-board hub, model number RTS5489-GR (hereafter “<span class="Strong">Realtek hub</span>”) as an example of a host-only port.</div><div id="wwpID0E0SI0HA" class="Heading_6" style="margin-bottom: 18pt">Go Through the Schematics</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 54pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 49.5pt"><div id="wwpID0EABA0RI0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 324pt"><div id="wwpID0EAAA0RI0HA" class="Note_Text">The P3509 carrier board’s schematic file is included in the “Jetson Xavier NX Developer Kit <span style="font-family: Arial">​</span>Carrier Board <span style="font-family: Arial">​</span>Design <span style="font-family: Arial">​</span>Files” archive, available from the <span class="Hyperlink"><a href="https://developer.nvidia.com/embedded/downloads#?search=Xavier%20NX%20Developer%20Kit%20Carrier" target="external_window">Jetson Download Center</a></span>. (Search for some consecutive words separated by spaces, e.g. “Xavier NX Developer Kit Carrier.”)</div></td></tr></table></div><div id="wwpID0E0QI0HA" class="Body_Text">Check the Realtek hub on the P3509 carrier board and find the socket location wired to the P3668 SOM.</div><div id="wwpID0E0PI0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>USB2 signal pins D+/D- (USP_D_P/USP_D_N) wire out from U7 and lead to module socket pins 117 (USB1_D) and 115 (USB1_D).</div><div class="ww_skin_page_overflow"><div id="wwpID0E0OI0HA" class="List_Continue"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/image2_12.png" style="display: inline; left: 0pt; top: 0pt" alt="A screenshot of a cell phoneDescription automatically generated" title="A screenshot of a cell phoneDescription automatically generated" /></div></div><div id="wwpID0E0NI0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>USB3 differential pairs (USP_TX_* and USP_RX_*) wire out from U7 and lead to module socket pins 161 (SBSS_RX) and 168 (USBSS_TX).</div><div class="ww_skin_page_overflow"><div id="wwpID0E0MI0HA" class="List_Continue"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/image3_12.png" style="display: inline; left: 0pt; top: 0pt" alt="A screenshot of a cell phoneDescription automatically generated" title="A screenshot of a cell phoneDescription automatically generated" /></div></div><div id="wwpID0E0LI0HA" class="Body_Text">Through the schematic, you can conclude that for U7:</div><div id="wwpID0E0KI0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>The USB2 signal pair is wired to UTMI pad 1 (USB2 port 1).</div><div id="wwpID0E0JI0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>The USB 3 signal pairs are wired to UPHY lane 1 (USB 3.1 port 2).</div><div id="wwpID0E0II0HA" class="Heading_6">The xusb_padctl Node</div><div id="wwpID0E0HI0HA" class="Body_Text">The device tree’s <span class="Code_Char">xusb_padctl</span> node follows the conventions of <span class="Code_Char">pinctrl-bindings.txt</span>. It contains two groups, named <span class="Code_Char">pads</span> and <span class="Code_Char">ports</span>, which describe USB2 and USB3 signals along with parameters and port numbers. The name of each parameter description subnode in <span class="Code_Char">pads</span> and <span class="Code_Char">ports</span> must be in the form <span class="Code_Char">&lt;type&gt;-&lt;port_number&gt;</span>, where <span class="Code_Char">&lt;type&gt;</span> is <span class="Code_Char">"usb2"</span> or <span class="Code_Char">"usb3"</span>, and <span class="Code_Char">&lt;port_number&gt;</span> is the associated port number.</div><div id="wwpID0E0GI0HA" class="Body_Text">The properties of the <span class="Code_Char">pads</span> subnode are:</div><div id="wwpID0E0FI0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">nvidia,function</span>: A string containing the name of the function to mux to the pin or group. Must be <span class="Code_Char">"xusb"</span>.</div><div id="wwpID0E0EI0HA" class="Body_Text">The properties of the <span class="Code_Char">ports</span> subnode are:</div><div id="wwpID0E0DI0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">mode</span>: A string that describes USB port capability. A port for USB2 must have this property. It must be one of these values:</div><div id="wwpID0E0CI0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">host</span></div><div id="wwpID0E0BI0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">device</span></div><div id="wwpID0E0AI0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">otg</span></div><div id="wwpID0E06H0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">nvidia,usb2-companion</span>: USB2 port (0, 1, or 2) to which the port is mapped. A port for USB3 must have this property.</div><div id="wwpID0E05H0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">nvidia,oc-pin</span>: The overcurrent VBUS pin the port is using. The value must be positive or zero.</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 67.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 45pt"><div id="wwpID0EABA04H0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 306pt"><div id="wwpID0EAAA04H0HA" class="Note_Text">Overcurrent detection and handling for U7, a Realtek hub on the P3509 carrier board, are controlled by the hub itself. Therefore, you need not set this property.</div></td></tr></table></div><div id="wwpID0E03H0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">vbus-supply</span>: VBUS regulator for the corresponding UTMI pad. Set to <span class="Code_Char">&amp;battery_reg</span> for a dummy regulator.</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 67.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 45pt"><div id="wwpID0EABA02H0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 306pt"><div id="wwpID0EAAA02H0HA" class="Note_Text">As the Realtek hub is always connected to the root hub port on a P3509, you need not control hub power, just enable it with VDD_3V3_SYS. Therefore, you must set dummy regulators for U7 on the P3509 carrier board.</div></td></tr></table></div><div id="wwpID0E01H0HA" class="Body_Text">For the detailed information about <span class="Code_Char">xusb_padctl</span>, refer to the documentation at:</div><div id="wwpID0E0ZH0HA" class="Code">kernel/kernel-4.9/Documentation/devicetree/bindings/phy/nvidia,xusb-padctl.txt</div><div id="wwpID0E0YH0HA" class="Body_Text">As an example, consider U7, the Realtek hub, which is always connected to USB2 port&nbsp;1 and USB3 port&nbsp;2 on the root hub. Create a pad/port node and property list for U7 based on the device tree structure described above:</div><div id="wwpID0E0XH0HA" class="Code">xusb_padctl: xusb_padctl@3520000 {</div><div id="wwpID0E0WH0HA" class="Code">    ...</div><div id="wwpID0E0VH0HA" class="Code">    pads {</div><div id="wwpID0E0UH0HA" class="Code">        usb2 {</div><div id="wwpID0E0TH0HA" class="Code">            lanes {</div><div id="wwpID0E0SH0HA" class="Code">                usb2-1 {</div><div id="wwpID0E0RH0HA" class="Code">                    nvidia,function = "xusb";</div><div id="wwpID0E0QH0HA" class="Code">                    status = "okay";</div><div id="wwpID0E0PH0HA" class="Code">                };</div><div id="wwpID0E0OH0HA" class="Code">                ...</div><div id="wwpID0E0NH0HA" class="Code">            };</div><div id="wwpID0E0MH0HA" class="Code">        };</div><div id="wwpID0E0LH0HA" class="Code">        usb3 {</div><div id="wwpID0E0KH0HA" class="Code">            lanes {</div><div id="wwpID0E0JH0HA" class="Code">                usb3-2 {</div><div id="wwpID0E0IH0HA" class="Code">                    nvidia,function = "xusb";</div><div id="wwpID0E0HH0HA" class="Code">                    status = "okay";</div><div id="wwpID0E0GH0HA" class="Code">                };</div><div id="wwpID0E0FH0HA" class="Code">            };</div><div id="wwpID0E0EH0HA" class="Code">        };</div><div id="wwpID0E0DH0HA" class="Code">    };</div><div id="wwpID0E0CH0HA" class="Code">    ports {</div><div id="wwpID0E0BH0HA" class="Code">        ...</div><div id="wwpID0E0AH0HA" class="Code">        usb2-1 {</div><div id="wwpID0E06G0HA" class="Code">            mode = "host";</div><div id="wwpID0E05G0HA" class="Code">            status = "okay";</div><div id="wwpID0E04G0HA" class="Code">        };</div><div id="wwpID0E03G0HA" class="Code">        ...</div><div id="wwpID0E02G0HA" class="Code">        usb3-0 {</div><div id="wwpID0E01G0HA" class="Code">            nvidia,usb2-companion = &lt;1&gt;;</div><div id="wwpID0E0ZG0HA" class="Code">            status = "okay";</div><div id="wwpID0E0YG0HA" class="Code">        };</div><div id="wwpID0E0XG0HA" class="Code">    };</div><div id="wwpID0E0WG0HA" class="Code">};</div><div id="wwpID0E0VG0HA" class="Heading_6">Under the xHCI Node</div><div id="wwpID0E0UG0HA" class="Body_Text">The Jetson TX2 NX xHCI controller complies with xHCI specifications, which support both USB 2.0 High Speed&nbsp;/ Full Speed&nbsp;/ Low Speed and USB 3.1 SuperSpeed protocols.</div><div id="wwpID0E0TG0HA" class="Body_Text">The properties of the node are:</div><div id="wwpID0E0SG0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">phys</span>: Must contain an entry for each entry in <span class="Code_Char">phy-names</span>.</div><div id="wwpID0E0RG0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">phy-names</span>: Must include an entry for each PHY used by the controller. Names must be in the form <span class="Code_Char">&lt;type&gt;-&lt;port_number&gt;</span>, where <span class="Code_Char">&lt;type&gt;</span> is <span class="Code_Char">"usb2"</span> or <span class="Code_Char">"usb3"</span>, and <span class="Code_Char">&lt;port_number&gt;</span> is the associated port number.</div><div id="wwpID0E0QG0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">nvidia,boost_cpu_freq</span>: Set the value to which CPU frequency will be boosted. This is only the minimum frequency; DVFS can scale up CPU frequency further based on need and CPU loading. CPU boost frequency is enabled through PMQOS for the xHCI controller only when this field’s value is greater than zero. The boost is applicable only for bulk and ISOC transfers; other endpoints do not need to be boosted.</div><div id="wwpID0E0PG0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">nvidia,boost_cpu_trigger</span>: Minimum buffer length of bulk or ISOC transfers beyond which to boost frequency.</div><div id="wwpID0E0OG0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">nvidia,xusb-padctl</span>: A pointer to the <span class="Code_Char">xusb-padctl</span> node.</div><div id="wwpID0E0NG0HA" class="Body_Text">For detailed information about xHCI, refer to the documentation at:</div><div id="wwpID0E0MG0HA" class="Code">kernel/kernel-4.9/Documentation/devicetree/bindings/usb/nvidia,tegra-xhci.txt</div><div id="wwpID0E0LG0HA" class="Body_Text">Consider U7, the Realtek hub, as an example. Create an xHCI node and property list for U7 based on the device tree structure described above:</div><div id="wwpID0E0KG0HA" class="Code">tegra_xhci: xhci@3610000 {</div><div id="wwpID0E0JG0HA" class="Code">    ...</div><div id="wwpID0E0IG0HA" class="Code">    phys = &lt;&amp;{/xusb_padctl@3520000/pads/usb2/lanes/usb2-1}&gt;,</div><div id="wwpID0E0HG0HA" class="Code">           &lt;&amp;{/xusb_padctl@3520000/pads/usb3/lanes/usb3-2}&gt;;</div><div id="wwpID0E0GG0HA" class="Code">    phy-names = "usb2-1", "usb3-2";</div><div id="wwpID0E0FG0HA" class="Code">    nvidia,xusb-padctl = &lt;&amp;xusb_padctl&gt;;</div><div id="wwpID0E0EG0HA" class="Code">    status = "okay";</div><div id="wwpID0E0DG0HA" class="Code">    ...</div><div id="wwpID0E0CG0HA" class="Code">};</div><div id="wwpID0E0BG0HA" class="Heading_5">For an OTG (On-The-Go) Compatible Port</div><div id="wwpID0E0AG0HA" class="Body_Text">USB On-The-Go, often abbreviated <span class="Strong">USB OTG</span> or just <span class="Strong">OTG</span>, is a specification that allows USB to act as a host or a device in the same port. A USB OTG port can switch back and forth between the roles of host and device.</div><div id="wwpID0E06F0HA" class="Body_Text">This section takes J5, USB2.0 Micro B connector, as an example of an OTG port.</div><div id="wwpID0E05F0HA" class="Body_Text">Jetson TX2 USB supports OTG features when connected to a device that has an OTG port. For OTG feature support a fifth pin, the <span class="Code_Char">ID</span> pin, is added to the standard USB connector.</div><div id="wwpID0E04F0HA" class="Body_Text">An OTG port adds a fifth pin to the standard USB connector, called the <span class="Strong">ID pin</span>. An OTG cable has an A-plug on one end and a B-plug on the other end. The A-plug’s ID pin is grounded, while the B-plug’s ID pin is floating. A device with an A-plug inserted becomes an OTG A-device (a host), and a device with a B-plug inserted becomes a B-device (a client device).</div><div class="ww_skin_page_overflow"><div id="wwpID0E03F0HA" class="Body_Text"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/image4_19.png" style="display: inline; left: 0pt; top: 0pt" alt="A screenshot of a cell phoneDescription automatically generated" title="A screenshot of a cell phoneDescription automatically generated" /></div></div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 49.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 45pt"><div id="wwpID0EABA02F0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 324pt"><div id="wwpID0EAAA02F0HA" class="Note_Text">Because its ID pin is floating, J5 is fixed in the device role in the Jetson Xavier NX Developer Kit. It cannot function as a host, e.g. to connect a flash drive, keyboard, or mouse.</div></td></tr></table></div><div id="wwpID0E01F0HA" class="Heading_6" style="margin-bottom: 18pt">Go Through the Schematics</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 49.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 49.5pt"><div id="wwpID0EABA0ZF0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 319.5pt"><div id="wwpID0EAAA0ZF0HA" class="Note_Text">The P3509 carrier board’s schematic file is included in <span class="Emphasis">Jetson Xavier NX Developer Kit Carrier Board Design Files</span>, available from the <span class="Hyperlink"><a href="https://developer.nvidia.com/embedded/downloads#?search=Xavier%20NX%20Developer%20Kit%20Carrier" target="external_window">Jetson Download Center</a></span>.</div></td></tr></table></div><div id="wwpID0E0YF0HA" class="Body_Text">Check the USB connectors on the P3509 carrier board and find the socket location wired to the P3668 SOM.</div><div id="wwpID0E0XF0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>USB2 signal pins D+/D− (DP and DN) wire out from J5 and lead to pin 111 (USB0_D) and pin 109 (USB0_D) on the SOM socket.</div><div class="ww_skin_page_overflow"><div id="wwpID0E0WF0HA" class="List_Continue"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/image5_17.png" style="display: inline; left: 0pt; top: 0pt" alt="A screenshot of a cell phoneDescription automatically generated" title="A screenshot of a cell phoneDescription automatically generated" /></div></div><div id="wwpID0E0VF0HA" class="Body_Text">The USB 2.0 Micro B connector, J5, supports only HighSpeed mode, and does not have USB3 signal pairs.</div><div id="wwpID0E0UF0HA" class="Body_Text">From the schematic, you can that for J5:</div><div id="wwpID0E0TF0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>The USB2 signal pair is wired to UTMI pad 0 (USB2 port 0).</div><div id="wwpID0E0SF0HA" class="Heading_6">The External Connector Class (extcon)</div><div id="wwpID0E0RF0HA" class="Body_Text">External connectors, which may have different types of cables attached (USB, TA, HDMI, Analog A/V, and others), often have device drivers that detect state changes at the port, and separate device drivers that do something according to the state changes.</div><div id="wwpID0E0QF0HA" class="Body_Text">The <span class="Strong">External Connector Class</span> (<span class="Code_Char">extcon</span>), introduced in 2012, supports the use of a notifier for passing information such as state changes between device drivers.</div><div id="wwpID0E0PF0HA" class="Body_Text">Generally, port switching between the roles of an OTG or OTG-compatible port is controlled by the host driver (xHCI) and device driver (xUDC), and can be defined by the state of the ID pin and the VBUS_DETECT pin.</div><div id="wwpID0E0OF0HA" class="Body_Text">Taking GPIO_M3 as the VBUS_DETECT pin and GPIO_Q0 as the ID pin, for example:</div><div id="wwpID0E0NF0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Find the corresponding GPIO states on the VBUS_DETECT pin and ID pin.</div><div id="wwpID0E0MF0HA" class="List_Continue">Generally, the ID pin is designed as internal pull high (logical high). With an A-plug connected the ID pin is pulled to ground (logical low), while with a B-plug connected or no cable connected it remains logical high.</div><div id="wwpID0E0LF0HA" class="List_Continue">The operation of the VBUS_DETECT pin depends on the device’s design. Consider the schematic in the following diagram, for example:</div><div class="ww_skin_page_overflow"><div id="wwpID0E0KF0HA" class="List_Continue"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/image6_14.png" style="display: inline; left: 0pt; top: 0pt" alt="A close up of a mapDescription automatically generated" title="A close up of a mapDescription automatically generated" /></div></div><div id="wwpID0E0JF0HA" class="List_Continue">With a B-plug connected VBUS_DETECT is logical low, because VBUS is provided from an external power supply, and when no cable is connected it is logical high.</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 67.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 45pt"><div id="wwpID0EABA0IF0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 301.5pt"><div id="wwpID0EAAA0IF0HA" class="Note_Text">VBUS_DETECT is initially logical high, then logical low because VBUS is provided by the host controller. Therefore, the state of the VBUS_DETECT pin does not matter when the OTG-compatible port is operating in host mode.</div></td></tr></table></div><div id="wwpID0E0HF0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Create the table of GPIO states and their corresponding output cable states:</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 48pt; padding-left: 5.75pt; padding-right: 5.75pt" cellspacing="0" summary=""><tr><th style="background-color: #DDEEBF; border-bottom-color: #7F7F7F; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #7F7F7F; border-left-style: solid; border-left-width: 0.5pt; border-right-color: #7F7F7F; border-right-style: solid; border-right-width: 0.75pt; border-top-color: #7F7F7F; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 0pt; padding-left: 0pt; padding-right: 0pt; padding-top: 0pt; vertical-align: bottom; width: 58.5pt"><div id="wwpID0EACE0GF0HA" class="Cell_Heading">GPIO_Q0 (ID)</div></th><th style="background-color: #DDEEBF; border-bottom-color: #7F7F7F; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #7F7F7F; border-left-style: solid; border-left-width: 0.75pt; border-right-color: #7F7F7F; border-right-style: solid; border-right-width: 0.75pt; border-top-color: #7F7F7F; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 0pt; padding-left: 0pt; padding-right: 0pt; padding-top: 0pt; vertical-align: bottom; width: 85.5pt"><div id="wwpID0EABE0GF0HA" class="Cell_Heading">GPIO_M3 (VBUS_DETECT)</div></th><th style="background-color: #DDEEBF; border-bottom-color: #7F7F7F; border-bottom-style: solid; border-bottom-width: 0.5pt; border-left-color: #7F7F7F; border-left-style: solid; border-left-width: 0.75pt; border-right-color: #7F7F7F; border-right-style: solid; border-right-width: 0.5pt; border-top-color: #7F7F7F; border-top-style: solid; border-top-width: 0.5pt; padding-bottom: 0pt; padding-left: 0pt; padding-right: 0pt; padding-top: 0pt; vertical-align: bottom; width: 139.5pt"><div id="wwpID0EAAE0GF0HA" class="Cell_Heading">EXTCON_STATE</div></th></tr><tr><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACD0GF0HA" class="Cell_Text" style="text-align: center">1</div></td><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABD0GF0HA" class="Cell_Text" style="text-align: center">1</div></td><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAD0GF0HA" class="Cell_Text">0x0 (EXCON_NONE)</div></td></tr><tr><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACC0GF0HA" class="Cell_Text" style="text-align: center">0</div></td><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABC0GF0HA" class="Cell_Text" style="text-align: center">0</div></td><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAC0GF0HA" class="Cell_Text">0x2 (EXTCON_USB_HOST)</div></td></tr><tr><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACB0GF0HA" class="Cell_Text" style="text-align: center">0</div></td><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABB0GF0HA" class="Cell_Text" style="text-align: center">1</div></td><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAB0GF0HA" class="Cell_Text">0x2 (EXTCON_USB_HOST)</div></td></tr><tr><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EACA0GF0HA" class="Cell_Text" style="text-align: center">1</div></td><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABA0GF0HA" class="Cell_Text" style="text-align: center">0</div></td><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAA0GF0HA" class="Cell_Text">0x1 (EXTCON_USB)</div></td></tr></table></div><div id="wwpID0E0FF0HA" class="Heading_6">Under the extcon Node</div><div id="wwpID0E0EF0HA" class="Body_Text">Port switching between OTG roles is defined by the state of the ID pin and the VBUS_DETECT pin and the settings of the external connector class.</div><div id="wwpID0E0DF0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">compatible</span>: Value must be <span class="Code_Char">"extcon-gpio-states"</span>.</div><div id="wwpID0E0CF0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">extcon-gpio,name</span>: Name of the <span class="Code_Char">extcon</span> device.</div><div id="wwpID0E0BF0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">gpios</span>: List of the GPIOs.</div><div id="wwpID0E0AF0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">extcon-gpio,irq-flags</span>: IRQ flags for GPIO.</div><div id="wwpID0E06E0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">extcon-gpio,debounce</span>: Debounce time in milliseconds.</div><div id="wwpID0E05E0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">extcon-gpio,wait-for-gpio-scan</span>: Wait timeout for scanning all GPIOs’ states after a GPIO state change is detected and debounce time has passed.</div><div id="wwpID0E04E0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">extcon-gpio,out-cable-names</span>: Output cable names.</div><div id="wwpID0E03E0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">extcon-gpio,cable-states</span>: GPIO states and their corresponding output cable states. The value is an array of bytes. Each even-numbered byte is a GPIO state, and the following odd-numbered byte is the corresponding output cable state.</div><div id="wwpID0E02E0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">cable-connected-on-boot</span>: Name of the output cable connected on boot, expressed as an index into <span class="Code_Char">extcon-gpio,out-cable-names</span>. The first element is index 0, and so on. If not specified, the system assumes that no cable is to be connected. This property is valid if no GPIOs are provided for cable states.</div><div id="wwpID0E01E0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">wakeup-source</span>: A Boolean; <span class="Code_Char">true</span> if the device can wake up the system.</div><div id="wwpID0E0ZE0HA" class="Body_Text">For the detailed information about <span class="Code_Char">extcon</span>, refer to the documentation at:</div><div id="wwpID0E0YE0HA" class="Code">kernel/kernel-4.9/Documentation/devicetree/bindings/extcon/extcon-gpio-states.txt</div><div id="wwpID0E0XE0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Create an <span class="Code_Char">extcon</span> device node and property list based on the device tree structure described above and the table of GPIO states and corresponding output cable states for GPIO_Q0 and GPIO_M3:</div><div id="wwpID0E0WE0HA" class="Code_Indent">vbus_id_extcon: extcon@1 {</div><div id="wwpID0E0VE0HA" class="Code_Indent">    compatible = "extcon-gpio-states";</div><div id="wwpID0E0UE0HA" class="Code_Indent">    extcon-gpio,name = "VBUS_ID";</div><div id="wwpID0E0TE0HA" class="Code_Indent">    extcon-gpio,wait-for-gpio-scan = &lt;0&gt;;</div><div id="wwpID0E0SE0HA" class="Code_Indent">    extcon-gpio,cable-states = &lt;0x3 0x0</div><div id="wwpID0E0RE0HA" class="Code_Indent">                                0x0 0x2</div><div id="wwpID0E0QE0HA" class="Code_Indent">                                0x1 0x2</div><div id="wwpID0E0PE0HA" class="Code_Indent">                                0x2 0x1&gt;;</div><div id="wwpID0E0OE0HA" class="Code_Indent">    gpios = &lt;&amp;tegra_main_gpio TEGRA194_MAIN_GPIO(M, 3) 0</div><div id="wwpID0E0NE0HA" class="Code_Indent">            &amp;tegra_main_gpio TEGRA194_MAIN_GPIO(Q, 0) 0&gt;;</div><div id="wwpID0E0ME0HA" class="Code_Indent">    extcon-gpio,out-cable-names =</div><div id="wwpID0E0LE0HA" class="Code_Indent">            &lt;EXTCON_USB EXTCON_USB_HOST EXTCON_NONE&gt;;</div><div id="wwpID0E0KE0HA" class="Code_Indent">    #extcon-cells = &lt;1&gt;;</div><div id="wwpID0E0JE0HA" class="Code_Indent">};</div><div id="wwpID0E0IE0HA" class="Body_Text">The USB 2.0 Micro B connector, J5, has the connector’s ID pin floating and the VBUS_DETECT pin of the connector wired out to GPIO00, which corresponds to GPIO_PZ1. Hence J5 can only function in the device role.</div><div class="ww_skin_page_overflow"><div id="wwpID0E0HE0HA" class="Body_Text"><img class="Default" src="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/images/image7_13.png" style="display: inline; left: 0pt; top: 0pt" alt="" title="" /></div></div><div id="wwpID0E0GE0HA" class="Body_Text">This table describes the GPIO states on J5 and the corresponding output cable states:</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 30pt; padding-left: 5.75pt; padding-right: 5.75pt" cellspacing="0" summary=""><tr><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 99pt"><div id="wwpID0EABC0FE0HA" class="Cell_Heading">GPIO_PZ1 (VBUS_DETECT)</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 130.5pt"><div id="wwpID0EAAC0FE0HA" class="Cell_Heading">EXTCON_STATE</div></td></tr><tr><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABB0FE0HA" class="Cell_Text" style="text-align: center">1</div></td><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAB0FE0HA" class="Cell_Text">0x0 (EXCON_NONE)</div></td></tr><tr><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EABA0FE0HA" class="Cell_Text" style="text-align: center">0</div></td><td style="background-color: #FFFFFF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top"><div id="wwpID0EAAA0FE0HA" class="Cell_Text">0x1 (EXTCON_USB)</div></td></tr></table></div><div id="wwpID0E0EE0HA" class="Body_Text">This is the <span class="Code_Char">extcon</span> device node and property list based on the device tree structure described above and the table of <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_nano.html#wwpID0EAAF0OG0HA" title="Jetson Nano Adaptation and Bring-Up">GPIO states and corresponding output cable states</a></span> for GPIO_PZ1, customized for Jetson Xavier NX, where the ID pin is floating the port is fixed in the device role:</div><div id="wwpID0E0DE0HA" class="Code">external-connection {</div><div id="wwpID0E0CE0HA" class="Code">    vbus_id_extcon: extcon@1 {</div><div id="wwpID0E0BE0HA" class="Code">        compatible = "extcon-gpio-states";</div><div id="wwpID0E0AE0HA" class="Code">        reg = &lt;0x1&gt;;</div><div id="wwpID0E06D0HA" class="Code">        extcon-gpio,name = "VBUS";</div><div id="wwpID0E05D0HA" class="Code">        extcon-gpio,cable-states = &lt;</div><div id="wwpID0E04D0HA" class="Code">                                    0x0 0x1</div><div id="wwpID0E03D0HA" class="Code">                                    0x1 0x0&gt;;</div><div id="wwpID0E02D0HA" class="Code">        gpios = &lt;&amp;tegra_main_gpio TEGRA194_MAIN_GPIO(Z, 1) 0&gt;;</div><div id="wwpID0E01D0HA" class="Code">        extcon-gpio,out-cable-names = &lt;EXTCON_USB EXTCON_USB_HOST EXTCON_NONE&gt;;</div><div id="wwpID0E0ZD0HA" class="Code">        wakeup-source;</div><div id="wwpID0E0YD0HA" class="Code">        #extcon-cells = &lt;1&gt;;</div><div id="wwpID0E0XD0HA" class="Code">    };</div><div id="wwpID0E0WD0HA" class="Code">};</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 49.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 45pt"><div id="wwpID0EABA0VD0HA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 319.5pt"><div id="wwpID0EAAA0VD0HA" class="Note_Text">Check the pinmux spreadsheet for the GPIO that corresponds to the ID pin and VBUS_DETECT pin.</div></td></tr></table></div><div id="wwpID0E0UD0HA" class="Heading_6">Under the xusb_padctl Node</div><div id="wwpID0E0TD0HA" class="Body_Text"><span class="Code_Char">xusb_padctl</span> settings for an OTG-compatible port are the same as for a host-only port except that the mode must be <span class="Code_Char">"otg"</span>.</div><div id="wwpID0E0SD0HA" class="Body_Text">Taking J5, the USB 2.0 Micro&nbsp;B connector, as an example, create a pad/port node and property list:</div><div id="wwpID0E0RD0HA" class="Code">xusb_padctl: xusb_padctl@3520000 {</div><div id="wwpID0E0QD0HA" class="Code">    ...</div><div id="wwpID0E0PD0HA" class="Code">    pads {</div><div id="wwpID0E0OD0HA" class="Code">        usb2 {</div><div id="wwpID0E0ND0HA" class="Code">            lanes {</div><div id="wwpID0E0MD0HA" class="Code">                usb2-0 {</div><div id="wwpID0E0LD0HA" class="Code">                    nvidia,function = "xusb";</div><div id="wwpID0E0KD0HA" class="Code">                    status = "okay";</div><div id="wwpID0E0JD0HA" class="Code">                };</div><div id="wwpID0E0ID0HA" class="Code">                ...</div><div id="wwpID0E0HD0HA" class="Code">            };</div><div id="wwpID0E0GD0HA" class="Code">        };</div><div id="wwpID0E0FD0HA" class="Code">        ...</div><div id="wwpID0E0ED0HA" class="Code">    };</div><div id="wwpID0E0DD0HA" class="Code">    ports {</div><div id="wwpID0E0CD0HA" class="Code">        usb2-0 {</div><div id="wwpID0E0BD0HA" class="Code">            mode = "otg";</div><div id="wwpID0E0AD0HA" class="Code">            vbus-supply = &lt;&amp;battery_reg&gt;;</div><div id="wwpID0E06C0HA" class="Code">            status = "okay";</div><div id="wwpID0E05C0HA" class="Code">        };</div><div id="wwpID0E04C0HA" class="Code">        ...</div><div id="wwpID0E03C0HA" class="Code">    };</div><div id="wwpID0E02C0HA" class="Code">};</div><div id="wwpID0E01C0HA" class="Heading_6">Under the xHCI Node</div><div id="wwpID0E0ZC0HA" class="Body_Text">The xHCI settings for an OTG-compatible port are the same as for a host-only port except for the addition of <span class="Code_Char">extcon</span> settings:</div><div id="wwpID0E0YC0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">extcon-cables</span>: OTG feature support. Must contain a pointer to the <span class="Code_Char">extcon-cable</span> entry for the USB ID pin. When the <span class="Code_Char">extcon</span> cable state is 0, the OTG-compatible port transitions to host mode.</div><div id="wwpID0E0XC0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">extcon-cable-names</span>: Must be <span class="Code_Char">"id"</span>.</div><div id="wwpID0E0WC0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">#extcon-cells</span>: Number of cells in the <span class="Code_Char">extcon</span> specifier. Must be 1.</div><div id="wwpID0E0VC0HA" class="Body_Text">Taking J51 the USB 2.0 Micro B connector, as an example, create an xHCI node and property list based on the device tree structure described in <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/adaptation_and_bringup_tx2_nx.html#wwpID0E0VG0HA" title="Jetson TX2 NX Adaptation and Bring-Up">Under the XHCI Node</a></span> for a host-only port, plus the extcon settings above:</div><div id="wwpID0E0UC0HA" class="Code">tegra_xhci: xhci@3610000 {</div><div id="wwpID0E0TC0HA" class="Code">    ...</div><div id="wwpID0E0SC0HA" class="Code">    extcon-cables = &lt;&amp;vbus_id_extcon 1&gt;;</div><div id="wwpID0E0RC0HA" class="Code">    extcon-cable-names = "id";</div><div id="wwpID0E0QC0HA" class="Code">    #extcon-cells = &lt;1&gt;;</div><div id="wwpID0E0PC0HA" class="Code">    phys = &lt;&amp;{/xusb_padctl@3520000/pads/usb2/lanes/usb2-0}&gt;;</div><div id="wwpID0E0OC0HA" class="Code">    phy-names = "usb2-0";</div><div id="wwpID0E0NC0HA" class="Code">    nvidia,xusb-padctl = &lt;&amp;xusb_padctl&gt;;</div><div id="wwpID0E0MC0HA" class="Code">    status = "okay";</div><div id="wwpID0E0LC0HA" class="Code">    ...</div><div id="wwpID0E0KC0HA" class="Code">};</div><div id="wwpID0E0JC0HA" class="Heading_6">Under the xUDC Node</div><div id="wwpID0E0IC0HA" class="Body_Text">The Jetson TX2 NX xUDC controller supports both USB 2.0 High Speed&nbsp;/ Full Speed and USB 3.1 SuperSpeed protocols.</div><div id="wwpID0E0HC0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">extcon-cables</span>: OTG feature support. Must contains an <span class="Code_Char">extcon-cable</span> entry which detects the USB VBUS pin. When the <span class="Code_Char">extcon</span> cable state is 1, the OTG-compatible port transitions to device mode.</div><div id="wwpID0E0GC0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">extcon-cable-names</span>: Must be <span class="Code_Char">"vbus"</span>.</div><div id="wwpID0E0FC0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">charger-detector</span>: USB charger detection support. Must be the phandle of the USB charger detection driver DT node.</div><div id="wwpID0E0EC0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">phys</span>: An array; must contain pointers to the nodes that define each PHY in <span class="Code_Char">phy-names</span>.</div><div id="wwpID0E0DC0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">phy-names</span>: An array; must contain an entry for each PHY used by the controller. Names must be in the form <span class="Code_Char">&lt;type&gt;-&lt;port_number&gt;</span>, where <span class="Code_Char">&lt;type&gt;</span> is one of <span class="Code_Char">"usb2"</span> or <span class="Code_Char">"usb3"</span>, and <span class="Code_Char">&lt;port_number&gt;</span> is the associated port number.</div><div id="wwpID0E0CC0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">nvidia,boost_cpu_freq</span>: The value to which CPU frequency is to be boosted. This is only the minimum frequency; DVFS can scale up CPU frequency further based on need and CPU load. CPU boost frequency through PMQOS is enabled for the xUDC controller only when this field’s value is greater than zero. The boost is applicable only to large bulk transfers on bulk endpoints; other endpoints do not need to be boosted.</div><div id="wwpID0E0BC0HA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">nvidia,xusb-padctl</span>: A pointer to the <span class="Code_Char">xusb-padctl</span> node.</div><div id="wwpID0E0AC0HA" class="Body_Text">For detailed information about xUDC, refer to the documentation at:</div><div id="wwpID0E06B0HA" class="Code">kernel/kernel-4.9</div><div id="wwpID0E05B0HA" class="Code">/Documentation/devicetree/bindings/usb/nvidia,tegra-xudc.txt</div><div id="wwpID0E04B0HA" class="Body_Text">Taking J5, the USB 2.0 Micro&nbsp;B connector, as an example, create an xUDC node and property list for J5 based on the device tree structure described above:</div><div id="wwpID0E03B0HA" class="Code">tegra_xudc: xudc@3550000 {</div><div id="wwpID0E02B0HA" class="Code">    extcon-cables = &lt;&amp;vbus_id_extcon 0&gt;;</div><div id="wwpID0E01B0HA" class="Code">    extcon-cable-names = "vbus";</div><div id="wwpID0E0ZB0HA" class="Code">    #extcon-cells = &lt;1&gt;;</div><div id="wwpID0E0YB0HA" class="Code">    phys = &lt;&amp;{/xusb_padctl@3520000/pads/usb2/lanes/usb2-0}&gt;;</div><div id="wwpID0E0XB0HA" class="Code">    phy-names = "usb2";</div><div id="wwpID0E0WB0HA" class="Code">    nvidia,xusb-padctl = &lt;&amp;xusb_padctl&gt;;</div><div id="wwpID0E0VB0HA" class="Code">    nvidia,boost_cpu_freq = &lt;1200&gt;;</div><div id="wwpID0E0UB0HA" class="Code">    status = "okay";</div><div id="wwpID0E0TB0HA" class="Code">};</div><H3 id="wwpID0E0SB0HA" class="Heading_3">Flashing the Build Image</H3><div id="wwpID0E0RB0HA" class="Body_Text">When flashing the build image, use your specific board name. The flashing script uses the configuration in the <span class="Code_Char">&lt;board&gt;.conf</span> file during the flashing process.</div><div id="wwpID0E0QB0HA" class="Heading_5">Setting Optional Environment Variables</div><div id="wwpID0E0PB0HA" class="Body_Text"><span class="Code_Char">flash.sh</span> script updates the following environment variables based on board EEPROM and other parameters passed. If you want to give specific values to these variables, define them in the board-specific file <span class="Code_Char">&lt;board&gt;.conf</span> to override the default values.</div><div id="wwpID0E0OB0HA" class="Code"><span style="font-size: 9pt"># Optional Environment Variables:</span></div><div id="wwpID0E0NB0HA" class="Code"><span style="font-size: 9pt"># BCTFILE ---------------- Boot control table configuration file to be used.</span></div><div id="wwpID0E0MB0HA" class="Code"><span style="font-size: 9pt"># BOARDID ---------------- Pass boardid to override EEPROM value</span></div><div id="wwpID0E0LB0HA" class="Code"><span style="font-size: 9pt"># BOARDREV --------------- Pass board_revision to override EEPROM value</span></div><div id="wwpID0E0KB0HA" class="Code"><span style="font-size: 9pt"># BOARDSKU --------------- Pass board_sku to override EEPROM value</span></div><div id="wwpID0E0JB0HA" class="Code"><span style="font-size: 9pt"># BOOTLOADER ------------- Bootloader binary to be flashed</span></div><div id="wwpID0E0IB0HA" class="Code"><span style="font-size: 9pt"># BOOTPARTLIMIT ---------- GPT data limit. (== Max BCT size + PPT size)</span></div><div id="wwpID0E0HB0HA" class="Code"><span style="font-size: 9pt"># BOOTPARTSIZE ----------- Total eMMC HW boot partition size.</span></div><div id="wwpID0E0GB0HA" class="Code"><span style="font-size: 9pt"># CFGFILE ---------------- Partition table configuration file to be used.</span></div><div id="wwpID0E0FB0HA" class="Code"><span style="font-size: 9pt"># CMDLINE ---------------- Target cmdline. See help for more information.</span></div><div id="wwpID0E0EB0HA" class="Code"><span style="font-size: 9pt"># DEVSECTSIZE ------------ Device Sector size. (default = 512Byte).</span></div><div id="wwpID0E0DB0HA" class="Code"><span style="font-size: 9pt"># DTBFILE ---------------- Device Tree file to be used.</span></div><div id="wwpID0E0CB0HA" class="Code"><span style="font-size: 9pt"># EMMCSIZE --------------- Size of target device eMMC (boot0+boot1+user).</span></div><div id="wwpID0E0BB0HA" class="Code"><span style="font-size: 9pt"># FLASHAPP --------------- Flash application running in host machine.</span></div><div id="wwpID0E0AB0HA" class="Code"><span style="font-size: 9pt"># FLASHER ---------------- Flash server running in target machine.</span></div><div id="wwpID0E6HA" class="Code"><span style="font-size: 9pt"># INITRD ----------------- Initrd image file to be flashed.</span></div><div id="wwpID0E5HA" class="Code"><span style="font-size: 9pt"># KERNEL_IMAGE ----------- Linux kernel zImage file to be flashed.</span></div><div id="wwpID0E4HA" class="Code"><span style="font-size: 9pt"># MTS -------------------- MTS file name such as mts_si.</span></div><div id="wwpID0E3HA" class="Code"><span style="font-size: 9pt"># MTSPREBOOT ------------- MTS preboot file name such as mts_preboot_si.</span></div><div id="wwpID0E2HA" class="Code"><span style="font-size: 9pt"># NFSARGS ---------------- Static Network assignments; client, server,</span></div><div id="wwpID0E1HA" class="Code"><span style="font-size: 9pt">#                          &amp; gateway IP addresses &amp; netmask in format:</span></div><div id="wwpID0EZHA" class="Code"><span style="font-size: 9pt">#                          &lt;c_IP&gt;:&lt;s_IP&gt;:&lt;g_IP&gt;:&lt;netmask&gt;</span></div><div id="wwpID0EYHA" class="Code"><span style="font-size: 9pt"># NFSROOT ---------------- NFSROOT, an IP address, colon, and path,</span></div><div id="wwpID0EXHA" class="Code"><span style="font-size: 9pt">#                          e.g. 127.0.0.1:/exported/rootfs_dir.</span></div><div id="wwpID0EWHA" class="Code"><span style="font-size: 9pt"># ODMDATA ---------------- Odmdata to be used.</span></div><div id="wwpID0EVHA" class="Code"><span style="font-size: 9pt"># PKCKEY ----------------- RSA key file to use to sign bootloader images.</span></div><div id="wwpID0EUHA" class="Code"><span style="font-size: 9pt"># ROOTFSSIZE ------------- Linux RootFS size (internal emmc/nand only).</span></div><div id="wwpID0ETHA" class="Code"><span style="font-size: 9pt"># ROOTFS_DIR ------------- Linux RootFS directory name.</span></div><div id="wwpID0ESHA" class="Code"><span style="font-size: 9pt"># SBKKEY ----------------- SBK key file to use to encrypt bootloader images.</span></div><div id="wwpID0ERHA" class="Code"><span style="font-size: 9pt"># SCEFILE ---------------- SCE firmware file such as camera-rtcpu-sce.img.</span></div><div id="wwpID0EQHA" class="Code"><span style="font-size: 9pt"># SPEFILE ---------------- SPE firmware file path such as bootloader/spe.bin.</span></div><div id="wwpID0EPHA" class="Code"><span style="font-size: 9pt"># FAB -------------------- Target board's FAB ID.</span></div><div id="wwpID0EOHA" class="Code"><span style="font-size: 9pt"># TEGRABOOT -------------- lowerlayer bootloader such as nvtboot.bin.</span></div><div id="wwpID0ENHA" class="Code"><span style="font-size: 9pt"># WB0BOOT ---------------- Warmboot code such as nvtbootwb0.bin</span></div><div id="wwpID0EMHA" class="Body_Text">&nbsp;</div><div class="ww_skin_page_overflow"><table class="Table_Normal" style="margin-left: 49.5pt" cellspacing="0" summary=""><tr><td style="background-color: #76B900; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 45pt"><div id="wwpID0EABALHA" class="Note_Image">Note:</div></td><td style="background-color: #DDEEBF; background-position: right center; border-bottom-color: Silver; border-bottom-style: solid; border-bottom-width: thin; border-left-color: Silver; border-left-style: solid; border-left-width: thin; border-right-color: Silver; border-right-style: solid; border-right-width: thin; border-top-color: Silver; border-top-style: solid; border-top-width: thin; padding-bottom: 3pt; padding-left: 3pt; padding-right: 3pt; padding-top: 3pt; vertical-align: top; width: 324pt"><div id="wwpID0EAAALHA" class="Note_Text">All the parameters must be added below the reference to the <span class="Code_Char" style="font-size: 10pt">p3668.conf.common</span> file to be reflected in the flashed image.</div></td></tr></table></div><div id="wwpID0EKHA" class="Body_Text">Here is an example of environment variable settings for the Jetson Xavier NX Developer Kit <span class="Code_Char">.conf</span> file, <span class="Code_Char">p3509-0000+p3668-0000-qspi-sd.conf</span>:</div><div id="wwpID0EJHA" class="Code">source "${LDK_DIR}/p3668.conf.common";</div><div id="wwpID0EIHA" class="Code">BLBlockSize=1048576;</div><div id="wwpID0EHHA" class="Code">EMMC_CFG=flash_l4t_t194_spi_sd_p3668.xml;</div><div id="wwpID0EGHA" class="Code">RECROOTFSSIZE=100MiB</div><div id="wwpID0EEHA" class="Heading_5">To flash the build image</div><div id="wwpID0EDHA" class="List_Bullet" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Execute the following command:</div><div id="wwpID0ECHA" class="Code">$ sudo ./flash.sh &lt;board&gt; mmcblk0p1</div><div id="wwpID0EBHA" class="Body_Text">&nbsp;</div></div><div id="page_dates"></div><!-- Related Topics --><!--                --><footer><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br /></footer></div></div><input type="hidden" id="preserve_unknown_file_links" value="false"></input><noscript><div id="noscript_warning">This site works best with JavaScript enabled</div></noscript><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></body></html>