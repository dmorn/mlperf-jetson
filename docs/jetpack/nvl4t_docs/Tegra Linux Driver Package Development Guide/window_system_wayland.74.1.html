<!DOCTYPE html ><html xml:lang="en" lang="en" data-highlight-require-whitespace="false" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><!-- NVIDIA customization --><title>NVIDIA Jetson Linux Driver Package Software Features : Window Systems | NVIDIA Docs </title><link rel="Prev" href="window_system_stub.html" title="Previous" /><link rel="Next" href="window_system_wayland.74.2.html" title="Next" /><link rel="StyleSheet" href="../css/font-awesome/css/font-awesome.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/window_system_wayland.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/social.css" type="text/css" media="all" /><link rel="StyleSheet" href="css/print.css" type="text/css" media="print" /><noscript><div id="noscript_padding"></div></noscript></head><body id="pN4thV9GmV8np_002bF0mnnKdC9g" class="ww_skin_page_body" style="visibility: hidden;"><input type="hidden" id="page_onload_url" value="../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html"></input><span id="dropdown_ids" style="display:none;"></span><div id="ww_content_container"><header id="wwconnect_header"><div class="ww_skin_page_toolbar"><div id="dropdown_button_container" class="dropdown_container dropdown_button_container_disabled"><a id="show_hide_all" class="ww_skin ww_behavior_dropdown_toggle ww_skin_dropdown_toggle" title="Page DropDown Toggle" href="#"><i class="fa"></i></a><span class="ww_skin_page_toolbar_divider">&nbsp;</span></div><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#"><i class="fa"></i></a></div><!-- was this helpful button --><!--                         --></header><div id="page_content_container" style="background-attachment: scroll; background-image: url(&quot;watermark.png&quot;); background-position: center center; background-repeat: no-repeat; margin-left: 0pt; margin-right: 10pt; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px"><div id="page_content"><H1 id="wwpID0E0PI0HA" class="Heading_2_Top">Weston (Wayland) Windowing System</H1><div class="WebWorks_MiniTOC"><div class="WebWorks_MiniTOC_Heading">&nbsp;</div><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0NI0HA">Running Weston 6.0</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0GH0HA">Multiple Display Heads</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0AH0HA">Example of weston.ini Display Options</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E02G0HA">Hot-Plugging</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0YG0HA">Verified Use Cases</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0SG0HA">Issues Fixed in Weston</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0YF0HA">Known Issues</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0WF0HA">Compositing Mode in Weston</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0ND0HA">NV16/NV24 in Weston</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0KD0HA">Shared-Memory Rendering</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0BD0HA">DMA Buffer Rendering</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0XC0HA">VPR Memory</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0KC0HA">Weston dma-buf Support</a></div></dd><dl class="WebWorks_MiniTOC_List"><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0IC0HA">Buffer Allocation</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E06B0HA">Buffer Write/read from CPU</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E0LB0HA">Wayland Protocol to Post dma-buf Buffers to Weston</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E4HA">GL Renderer in Weston</a></div></dd><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0E2HA">Display Hardware Compositing in Weston</a></div></dd></dl><dd><div class="WebWorks_MiniTOC_Entry"><a class="WebWorks_MiniTOC_Link" href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/window_system_wayland.74.1.html#wwpID0EZHA">weston-debug</a></div></dd></dl></div><div id="wwpID0E0OI0HA" class="Body_Text">L4T supports the Weston implementation of the Wayland windowing system. The current release of L4T supports Weston 6.0.</div><H3 id="wwpID0E0NI0HA" class="Heading_3">Running Weston 6.0</H3><div id="wwpID0E0MI0HA" class="Body_Text">The current release of Jetpack supports Weston 6.0. You can launch it by entering these commands:</div><div id="wwpID0E0LI0HA" class="Code"># Stop X xerver.</div><div id="wwpID0E0KI0HA" class="Code">sudo service gdm stop; sudo pkill -9 Xorg</div><div id="wwpID0E0JI0HA" class="Code">&nbsp;</div><div id="wwpID0E0II0HA" class="Code"># Use Tegra dummy DRM driver.</div><div id="wwpID0E0HI0HA" class="Code">sudo modprobe tegra-udrm modeset=1</div><div id="wwpID0E0GI0HA" class="Code">sudo ln -sf /usr/lib/aarch64-linux-gnu/tegra/libnvgbm.so /usr/lib/aarch64-linux-gnu/libgbm.so.1</div><div id="wwpID0E0FI0HA" class="Code">&nbsp;</div><div id="wwpID0E0EI0HA" class="Code"># Environment and directory setup.</div><div id="wwpID0E0DI0HA" class="Code">unset DISPLAY</div><div id="wwpID0E0CI0HA" class="Code">mkdir /tmp/xdg</div><div id="wwpID0E0BI0HA" class="Code">chmod 700 /tmp/xdg</div><div id="wwpID0E0AI0HA" class="Code">&nbsp;</div><div id="wwpID0E06H0HA" class="Code"># Choose a valid tty.</div><div id="wwpID0E05H0HA" class="Code">export WESTON_TTY=1 </div><div id="wwpID0E04H0HA" class="Code">&nbsp;</div><div id="wwpID0E03H0HA" class="Code"># Launch Weston as root user.</div><div id="wwpID0E02H0HA" class="Code">sudo XDG_RUNTIME_DIR=/tmp/xdg weston --tty="$WESTON_TTY" --idle-time=0 &amp; </div><div id="wwpID0E01H0HA" class="Code"># Optional: WAYLAND_DEBUG=server</div><div id="wwpID0E0ZH0HA" class="Code"># Optional: use --use-egldevice to disable gbm swapchains and use EGLStreams at weston output</div><div id="wwpID0E0YH0HA" class="Code">&nbsp;</div><div id="wwpID0E0XH0HA" class="Code"># Launch Weston using weston-launch as a non-root user.</div><div id="wwpID0E0WH0HA" class="Code">sudo groupadd weston-launch</div><div id="wwpID0E0VH0HA" class="Code">sudo usermod -a -G weston-launch $USER</div><div id="wwpID0E0UH0HA" class="Code">sudo chown root /usr/bin/weston-launch</div><div id="wwpID0E0TH0HA" class="Code">sudo chmod +s /usr/bin/weston-launch</div><div id="wwpID0E0SH0HA" class="Code">weston-launch &amp;</div><div id="wwpID0E0RH0HA" class="Code">&nbsp;</div><div id="wwpID0E0QH0HA" class="Code"># Run a client.</div><div id="wwpID0E0PH0HA" class="Code">XDG_RUNTIME_DIR=/tmp/xdg weston-simple-egl</div><div id="wwpID0E0OH0HA" class="Code"># Optional: WAYLAND_DEBUG=1</div><div id="wwpID0E0NH0HA" class="Code">&nbsp;</div><div id="wwpID0E0MH0HA" class="Code"># For running Weston tests, the weston-test.so module must be loaded by a parameter, or in weston.ini.</div><div id="wwpID0E0LH0HA" class="Code"># E.g. --modules=/usr/lib/aarch64-linux-gnu/tegra/weston/weston-test.so</div><div id="wwpID0E0KH0HA" class="Code">&nbsp;</div><div id="wwpID0E0JH0HA" class="Code"># For launching Weston with ivi-shell + ivi-controller on</div><div id="wwpID0E0IH0HA" class="Code"># the device, pass the arguments to the weston binary as:</div><div id="wwpID0E0HH0HA" class="Code">#     --shell=ivi-shell.so --modules=ivi-controller.so</div><H3 id="wwpID0E0GH0HA" class="Heading_3">Multiple Display Heads</H3><div id="wwpID0E0FH0HA" class="Body_Text">NVIDIA<span style="vertical-align: super">®</span> Jetson Nano™ devices and Jetson TX2 series devices support multiple display heads with multiple overlays as described in the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/display_configuration.html#" title="Display Configuration and Bringup">Display Configuration and Bring-Up</a></span> topic of the <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/introduction.html#" title="Introduction">Jetson Linux Driver Package Development Guide</a></span>.</div><div id="wwpID0E0EH0HA" class="Body_Text">Weston 6.0 supports multiple heads on L4T as well. Use <span class="Code_Char">weston.ini</span> to set the expected resolution and orientation of the monitors.</div><div id="wwpID0E0DH0HA" class="Body_Text">If multiple displays are connected, applications are launched on the one that contains the mouse pointer at the time of launch. Once an application is launched, you can drag it across a boundary between displays.</div><div id="wwpID0E0CH0HA" class="Body_Text">If multiple displays are connected and they have different resolutions, Weston reports the frame rate of the display on which more than 50% of its window is displayed.</div><div id="wwpID0E0BH0HA" class="Body_Text">If a monitor is removed while Weston is running (hot removal), running applications dynamically shift to the remaining active monitor.</div><H3 id="wwpID0E0AH0HA" class="Heading_3">Example of weston.ini Display Options</H3><div id="wwpID0E06G0HA" class="Body_Text">Use this example as a model for setting your own display options in <span class="Code_Char">weston.ini</span>.</div><div id="wwpID0E05G0HA" class="Code">name=HDMI-A-1</div><div id="wwpID0E04G0HA" class="Code">mode=1920 x 1080</div><div id="wwpID0E03G0HA" class="Code">transform=90 (0,90,180,270)</div><H3 id="wwpID0E02G0HA" class="Heading_3">Hot-Plugging</H3><div id="wwpID0E01G0HA" class="Body_Text">Weston monitors events sent by the Direct Rendering Manager (<span class="Strong">DRM</span>) subsystem using udev. When the display configuration changes, udev receives a HOTPLUG event. It calls <span class="Code_Char">drmModeGetResources()</span> to identify connectors that have been added or removed, and takes actions accordingly.</div><div id="wwpID0E0ZG0HA" class="Body_Text">On T210 there is no real kernel mode DRM driver; instead there is a user mode DRM driver, <span class="Code_Char">drm-nvdc</span>, and a dummy kernel mode DRM driver, <span class="Code_Char">tegra-udrm</span>. These drivers work together to provide a real DRM driver-like interface to Weston. The <span class="Code_Char">tegra-udrm</span> driver signals a HOTPLUG event when the display connection state changes.</div><H4 id="wwpID0E0YG0HA" class="Heading_4">Verified Use Cases</H4><div id="wwpID0E0XG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Disconnect and connect the HDMI™ display after launching Weston.</div><div id="wwpID0E0WG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Disconnect and connect the HDMI display while the application <span class="Code_Char">nvgldemo</span> is running, and verify that application drawing is visible after connection.</div><div id="wwpID0E0VG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Launch Weston without an HDMI display connected and then connect an HDMI display.</div><div id="wwpID0E0UG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Launch Weston without an HDMI display connected, launch the <span class="Code_Char">nvgldemo</span> application, and then connect an HDMI display.</div><div id="wwpID0E0TG0HA" class="Body_Text">All of the use cases above are also verified with DisplayPort displays.</div><H4 id="wwpID0E0SG0HA" class="Heading_4">Issues Fixed in Weston</H4><div id="wwpID0E0RG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Application window disappears when display is re-connected.</div><div id="wwpID0E0QG0HA" class="List_Continue">A fix for this issue has been backported to the downstream Weston 6 codeline from the upstream Weston main codeline. See the <span class="Hyperlink"><a href="https://gitlab.freedesktop.org/wayland/weston/issues/210 for more information" target="external_window">freedesktop.org GitLab</a></span> for more information.</div><div id="wwpID0E0PG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Weston crashes using <span class="Code_Char">ivi-shell</span> when no display is connected.</div><div id="wwpID0E0OG0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Support added for multiple hotplug displays in <span class="Code_Char">ivi-shell</span>.</div><div id="wwpID0E0NG0HA" class="List_Continue"><span class="Code_Char">ivi-shell</span> was not originally designed to support hotplug. This is an NVIDIA enhancement.</div><div id="wwpID0E0MG0HA" class="List_Continue">The fix adds a protocol to <span class="Code_Char">ivi-vm</span> which lets the client receive a hotplug event sent by <span class="Code_Char">ivi-controller</span>. The client must handle the event during hotplug using the ivi-layermanagement API to relocate surfaces, destroy surfaces, and so on. The client can create listeners to listen for the <span class="Code_Char">connector_name</span>, <span class="Code_Char">screen_id</span>, and <span class="Code_Char">screen_destroy</span> events in the <span class="Code_Char">ivi-wm-screen</span> interface to the <span class="Code_Char">ivi-wm</span> protocol to get notifications of hot plugging.</div><div id="wwpID0E0LG0HA" class="List_Continue">Following is some example code:</div><div id="wwpID0E0KG0HA" class="Code">static void</div><div id="wwpID0E0JG0HA" class="Code">screen_id(void *data, struct ivi_wm_screen *ivi_wm_screen, uint32_t id);</div><div id="wwpID0E0IG0HA" class="Code">&nbsp;</div><div id="wwpID0E0HG0HA" class="Code">static void</div><div id="wwpID0E0GG0HA" class="Code">screen_destroy(void *data,struct ivi_wm_screen *ivi_wm_screen,  uint32_t id);</div><div id="wwpID0E0FG0HA" class="Code">&nbsp;</div><div id="wwpID0E0EG0HA" class="Code">static void</div><div id="wwpID0E0DG0HA" class="Code">connector_name(void *data, struct ivi_wm_screen *ivi_wm_screen, const char *process_name);</div><div id="wwpID0E0CG0HA" class="Code">&nbsp;</div><div id="wwpID0E0BG0HA" class="Code">struct ivi_wm_screen_listener wm_screen_listener = {</div><div id="wwpID0E0AG0HA" class="Code">    screen_id,</div><div id="wwpID0E06F0HA" class="Code">    screen_destroy,</div><div id="wwpID0E05F0HA" class="Code">    layer_added,</div><div id="wwpID0E04F0HA" class="Code">    connector_name,</div><div id="wwpID0E03F0HA" class="Code">    error,</div><div id="wwpID0E02F0HA" class="Code">};</div><div id="wwpID0E01F0HA" class="Code">&nbsp;</div><div id="wwpID0E0ZF0HA" class="Code">ivi_wm_screen_add_listener(ivi_wm_screen, &amp;wm_screen_listener, args);</div><H4 id="wwpID0E0YF0HA" class="Heading_4">Known Issues</H4><div id="wwpID0E0XF0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>There is currently no way for the DRM module to notify Weston that a page flip has failed. Consequently, when Weston is configured to support multiple displays, hot-plugging a display at certain times may cause <span class="Code_Char">drmAtomicCommit()</span> to fail with a “page flip pending” assertion.</div><H3 id="wwpID0E0WF0HA" class="Heading_3">Compositing Mode in Weston</H3><div id="wwpID0E0VF0HA" class="Body_Text">Weston supports mixed mode compositing using dma-buf. The T210 has three display windows per head. Weston assigns one window to the GFX plane. The other two are available to be renamed as secondary overlay planes. On every frame Weston evaluates all surfaces and views and chooses one of these strategies to composite them:</div><div id="wwpID0E0UF0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">DRM_OUTPUT_PROPOSE_STATE_MIXED</span> (Overlay + GL)</div><div id="wwpID0E0TF0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">DRM_OUTPUT_PROPOSE_STATE_RENDERER_ONLY</span> (GL)</div><div id="wwpID0E0SF0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">DRM_OUTPUT_PROPOSE_STATE_PLANES_ONLY</span> (Overlay only)</div><div id="wwpID0E0RF0HA" class="Body_Text">The demo application <span class="Code_Char">weston-simple-dmabuf-egldevice</span> demonstrates mixed-mode compositing path in weston, where some surfaces are assigned overlay planes and others are composited with GL.</div><div id="wwpID0E0QF0HA" class="Body_Text">You can use the application <span class="Code_Char">weston-debug</span> to verify that overlay plans are being assigned. Use the following procedure.</div><div id="wwpID0E0PF0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Stop X if it is running and prepare the device for launching Weston:</div><div id="wwpID0E0OF0HA" class="Code">$ sudo service gdm stop; sudo pkill -9 Xorg</div><div id="wwpID0E0NF0HA" class="Code">$ unset DISPLAY</div><div id="wwpID0E0MF0HA" class="Code">$ mkdir /tmp/xdg</div><div id="wwpID0E0LF0HA" class="Code">$ chmod 700 /tmp/xdg</div><div id="wwpID0E0KF0HA" class="Code">$ export WESTON_TTY=1</div><div id="wwpID0E0JF0HA" class="Code">$ sudo modprobe tegra-udrm modeset=1</div><div id="wwpID0E0IF0HA" class="Code">$ sudo ln -sf /usr/lib/aarch64-linux-gnu/tegra/libnvgbm.so /usr/lib/aarch64-linux-gnu/libgbm.so.1</div><div id="wwpID0E0HF0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Launch Weston with the <span class="Code_Char">--debug</span> switch:</div><div id="wwpID0E0GF0HA" class="Code">$ sudo XDG_RUNTIME_DIR=/tmp/xdg weston --tty="$WESTON_TTY" --idle-time=0 --debug &amp;</div><div id="wwpID0E0FF0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>Launch a few Weston client applications:</div><div id="wwpID0E0EF0HA" class="Code">$ sudo XDG_RUNTIME_DIR=/tmp/xdg weston-simple-egl &amp;</div><div id="wwpID0E0DF0HA" class="Code">$ sudo XDG_RUNTIME_DIR=/tmp/xdg weston-simple-dmabuf-egldevice &amp;</div><div id="wwpID0E0CF0HA" class="Code">$ sudo XDG_RUNTIME_DIR=/tmp/xdg weston-simple-dmabuf-egldevice &amp;</div><div id="wwpID0E0BF0HA" class="Code">$ sudo XDG_RUNTIME_DIR=/tmp/xdg weston-simple-dmabuf-egldevice &amp;</div><div id="wwpID0E0AF0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>4.	</span></span>Run the <span class="Code_Char">weston-debug</span> application:</div><div id="wwpID0E06E0HA" class="Code">$ sudo XDG_RUNTIME_DIR=/tmp/xdg ./weston-debug -a</div><div id="wwpID0E05E0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>5.	</span></span>Look for information like that shown below in the <span class="Code_Char">weston-debug</span> output. Blue colored surfaces are overlay-composited and green-colored surfaces are GL-composited.</div><div id="wwpID0E04E0HA" class="Code">Layer 5 (pos 0x50000000):</div><div id="wwpID0E03E0HA" class="Code">    View 0 (role xdg_toplevel, PID 8080, surface ID 3, top-level window 'simple-dmabuf-egldevice', 0x33c798b0):</div><div id="wwpID0E02E0HA" class="Code">        position: (714, 860) -&gt; (970, 1116)</div><div id="wwpID0E01E0HA" class="Code">        [not opaque]</div><div id="wwpID0E0ZE0HA" class="Code">        outputs: 0 (HDMI-A-1) (primary)</div><div id="wwpID0E0YE0HA" class="Code">        dmabuf buffer</div><div id="wwpID0E0XE0HA" class="Code">                format: 0x34325258 XRGB8888</div><div id="wwpID0E0WE0HA" class="Code">                modifier: 0x3800000000fe014</div><div id="wwpID0E0VE0HA" class="Code">    View 1 (role xdg_toplevel, PID 8073, surface ID 3, top-level window 'simple-dmabuf-egldevice', 0x33bb9500):</div><div id="wwpID0E0UE0HA" class="Code">        position: (209, 591) -&gt; (465, 847)</div><div id="wwpID0E0TE0HA" class="Code">         [not opaque]</div><div id="wwpID0E0SE0HA" class="Code">        outputs: 0 (HDMI-A-1) (primary)</div><div id="wwpID0E0RE0HA" class="Code">        dmabuf buffer</div><div id="wwpID0E0QE0HA" class="Code">            format: 0x34325258 XRGB8888</div><div id="wwpID0E0PE0HA" class="Code">            modifier: 0x3800000000fe014</div><div id="wwpID0E0OE0HA" class="Code">&nbsp;</div><div id="wwpID0E0NE0HA" class="Code">    View 2 (role xdg_toplevel, PID 8066, surface ID 3, top-level window 'simple-dmabuf-egldevice', 0x31769110):</div><div id="wwpID0E0ME0HA" class="Code">        position: (1129, 339) -&gt; (1385, 595)</div><div id="wwpID0E0LE0HA" class="Code">        [not opaque]</div><div id="wwpID0E0KE0HA" class="Code">        outputs: 0 (HDMI-A-1) (primary)</div><div id="wwpID0E0JE0HA" class="Code">        dmabuf buffer</div><div id="wwpID0E0IE0HA" class="Code">            format: 0x34325258 XRGB8888</div><div id="wwpID0E0HE0HA" class="Code">            modifier: 0x3800000000fe014</div><div id="wwpID0E0GE0HA" class="Code">&nbsp;</div><div id="wwpID0E0FE0HA" class="Code">View 3 (role xdg_toplevel, PID 8051, surface ID 9, top-level window 'simple-egl', 0x314c6430):</div><div id="wwpID0E0EE0HA" class="Code">    position: (1343, 642) -&gt; (1593, 892)</div><div id="wwpID0E0DE0HA" class="Code">     [not opaque]</div><div id="wwpID0E0CE0HA" class="Code">    outputs: 0 (HDMI-A-1) (primary)</div><div id="wwpID0E0BE0HA" class="Code">    EGL buffer</div><div id="wwpID0E0AE0HA" class="Code">&nbsp;</div><div id="wwpID0E06D0HA" class="Code">Layer 6 (pos 0x2):</div><div id="wwpID0E05D0HA" class="Code">    ...</div><div id="wwpID0E04D0HA" class="Code">     [view] evaluating view 0x33c798b0 for output HDMI-A-1 (0)</div><div id="wwpID0E03D0HA" class="Code">     [view] view 0x33c798b0 format: XRGB8888</div><div id="wwpID0E02D0HA" class="Code">         [overlay] provisionally placing view 0x33c798b0 on overlay 4002 in mixed mode</div><div id="wwpID0E01D0HA" class="Code">     [view] evaluating view 0x33bb9500 for output HDMI-A-1 (0)</div><div id="wwpID0E0ZD0HA" class="Code">     [view] view 0x33bb9500 format: XRGB8888</div><div id="wwpID0E0YD0HA" class="Code">         [overlay] provisionally placing view 0x33bb9500 on overlay 4001 in mixed mode</div><div id="wwpID0E0XD0HA" class="Code">     [view] evaluating view 0x31769110 for output HDMI-A-1 (0)</div><div id="wwpID0E0WD0HA" class="Code">     [view] view 0x31769110 format: XRGB8888</div><div id="wwpID0E0VD0HA" class="Code">         [overlay] not placing view 0x31769110 on overlay: no free overlay planes</div><div id="wwpID0E0UD0HA" class="Code">     [view] evaluating view 0x314c6430 for output HDMI-A-1 (0)</div><div id="wwpID0E0TD0HA" class="Code">         [overlay] not placing view 0x314c6430 on overlay: couldn't get fb</div><div id="wwpID0E0SD0HA" class="Code">[repaint] Using mixed state composition</div><div id="wwpID0E0RD0HA" class="Code">[repaint] view 0x33c798b0 on Overlay plane 4002</div><div id="wwpID0E0QD0HA" class="Code">[repaint] view 0x33bb9500 on Overlay plane 4001</div><div id="wwpID0E0PD0HA" class="Code">[repaint] view 0x31769110 using renderer composition</div><div id="wwpID0E0OD0HA" class="Code">[repaint] view 0x314c6430 using renderer composition</div><H3 id="wwpID0E0ND0HA" class="Heading_3">NV16/NV24 in Weston</H3><div id="wwpID0E0MD0HA" class="Body_Text">The Weston GL compositor adds support for NV16 and NV24 content via shared memory buffers.</div><div id="wwpID0E0LD0HA" class="Body_Text">Applications that use the <span class="Code_Char">WL_SHM_FORMAT_NV24</span> enum can substitute <span class="Code_Char">DRM_FORMAT_NV24</span>, as by convention both enums use symbols defined in <span class="Code_Char">drm_fourcc.h</span>.</div><H3 id="wwpID0E0KD0HA" class="Heading_3">Shared-Memory Rendering</H3><div id="wwpID0E0JD0HA" class="Body_Text">The Weston test <span class="Code_Char">color-format.weston</span> exercises shared-memory rendering for all formats that Weston currently supports. Though implemented as a test case, it is intended for visual verification, and it must be manually terminated.</div><div id="wwpID0E0ID0HA" class="Heading_5">To run the test case</div><div id="wwpID0E0HD0HA" class="List_Number" style="text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Start Weston with the <span class="Code_Char">weston-test.so</span> module, for example:</div><div id="wwpID0E0GD0HA" class="Code">$ sudo XDG_RUNTIME_DIR=/tmp/xdg weston --tty="$WESTON_TTY" --idle-time=0 --modules=weston-test.so &amp;</div><div id="wwpID0E0FD0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Enter this command to execute the test application:</div><div id="wwpID0E0ED0HA" class="Code">$ sudo XDG_RUNTIME_DIR=/tmp/xdg color-format.weston</div><div id="wwpID0E0DD0HA" class="List_Continue">The application displays eight color test patterns, each rendered using a different color format. All should appear substantially identical, with minor variations caused by the limitations of the formats.</div><div id="wwpID0E0CD0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>3.	</span></span>To terminate the test, enter Ctrl-C.</div><H3 id="wwpID0E0BD0HA" class="Heading_3">DMA Buffer Rendering</H3><div id="wwpID0E0AD0HA" class="Body_Text">DRM now supports NV16 and NV24 color formats. To use these formats, construct an <span class="Code_Char">EGLImage</span> from the DMA buffer via the exposed <span class="Code_Char">EXT_image_dma_buf_import</span> and <span class="Code_Char">EXT_image_dma_buf_import_modifiers</span> extensions.</div><div id="wwpID0E06C0HA" class="Body_Text">Currently only block-linear DMA buffer layouts are supported. <span class="Code_Char">DRM_FORMAT_NV21</span>, <span class="Code_Char">DRM_FORMAT_NV16</span>, and <span class="Code_Char">DRM_FORMAT_NV24</span> have been added to <span class="Code_Char">supported_drm_formats</span>.</div><div id="wwpID0E05C0HA" class="Heading_5">To run a verified use case (video playback test)</div><div id="wwpID0E04C0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Enter this command:</div><div id="wwpID0E03C0HA" class="Code">$ gst-launch-1.0 filesrc location=&lt;mp4_src_file&gt; ! qtdemux ! h264parse ! nvv4l2decoder ! nvvidconv ! 'video/x-raw(memory:NVMM), width=(int)1280, height=(int)720, format=(string)&lt;format&gt;' ! nvdrmvideosink</div><div id="wwpID0E02C0HA" class="List_Continue">Where:</div><div id="wwpID0E01C0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">&lt;mp4_src_file&gt;</span> is the pathname of the <span class="Code_Char">apt</span> source file</div><div id="wwpID0E0ZC0HA" class="List_Bullet_2"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Code_Char">&lt;format&gt;</span> is <span class="Code_Char">NV16</span> or <span class="Code_Char">NV24</span>.</div><div id="wwpID0E0YC0HA" class="List_Continue">The <span class="Code_Char">gst-launch-1.0</span> command is a GStreamer pipeline to display video. It uses the <span class="Code_Char">nvvidconv</span> plugin to convert other formats in the stream to NV16/NV24. The video is displayed with the <span class="Code_Char">nvdrmvideosink</span> plugin, which internally uses DRM.</div><H3 id="wwpID0E0XC0HA" class="Heading_3">VPR Memory</H3><div id="wwpID0E0WC0HA" class="Body_Text">You can allocate VPR memory using <span class="Code_Char">nbuf_utils</span>, GBM and <span class="Code_Char">eglStream</span>.</div><div id="wwpID0E0VC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Strong">With nvbuf_utils</span>: Add the <span class="Code_Char">NvBufferTag_PROTECTED</span> tag via <span class="Code_Char">NvBufferCreateParams()</span> and pass to <span class="Code_Char">NvBufferCreate()</span>.</div><div id="wwpID0E0UC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Strong">With GBM</span>: Specify the <span class="Code_Char">GBM_BO_USE_PROTECTED</span> usage flag for <span class="Code_Char">gbm_bo_create()</span>.</div><div id="wwpID0E0TC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span><span class="Strong">With EglStreams</span>: Add the <span class="Code_Char">EGL_PROTECTED_CONTENT_EXT</span> attribute when creating <span class="Code_Char">eglSurface</span> objects. Specify the texture parameter <span class="Code_Char">GL_TEXTURE_PROTECTED_EXT</span> for protected textures.</div><div id="wwpID0E0SC0HA" class="Body_Text">To write to protected textures with GL you must also use a protected context, which you may create by specifying the <span class="Code_Char">EGL_PROTECTED_CONTENT_EXT</span> attribute. Note that you must also specify this attribute when you import <span class="Code_Char">dmabuf</span> into EGL, in the case where the dmabuf is created in VPR memory.</div><div id="wwpID0E0RC0HA" class="Heading_5">To run a sample case</div><div id="wwpID0E0QC0HA" class="List_Bullet"><span class="WebWorks_Number" style="width: 18pt"><span>•	</span></span>Run the <span class="Code_Char">weston-simple-dmabuf-egldevice</span> app with the <span class="Code_Char">-p</span> switch.</div><div id="wwpID0E0PC0HA" class="Body_Text">To verify the correctness of the result, examine it on the screen. It should be the same as when you run the app without using VPR memory.</div><div id="wwpID0E0OC0HA" class="Heading_5">Current Limitations</div><div id="wwpID0E0NC0HA" class="Body_Text">The VPR content can only be rendered on the screen with overlay GLcomposition. GL does not support protected content yet. Such support will be added in later releases.</div><div id="wwpID0E0MC0HA" class="Body_Text">Thus, if there are several windows on the screen exceeding the limit for overlay composition, protected content is not rendered for the excess windows.</div><div id="wwpID0E0LC0HA" class="Body_Text">HDCP support is not available yet. It will be supported in a future release. For Jetson Nano devices, though, you can display VPR content onscreen even without establishing an HDCP link.</div><H3 id="wwpID0E0KC0HA" class="Heading_3">Weston dma-buf Support</H3><div id="wwpID0E0JC0HA" class="Body_Text">Clients can post dma-buf buffers to Weston using the Linux DMA-BUF Unstable V1 Protocol of Wayland. Dma-buf support with Weston has following components.</div><H4 id="wwpID0E0IC0HA" class="Heading_4">Buffer Allocation</H4><div id="wwpID0E0HC0HA" class="Body_Text">GBM is commonly used to allocate buffers, which are backed by the dma-buf file descriptor.</div><div id="wwpID0E0GC0HA" class="Body_Text">This code snippet shows how to allocate a buffer using GBM:</div><div id="wwpID0E0FC0HA" class="Code">drm_fd = open("/dev/dri/card0", O_RDWR);</div><div id="wwpID0E0EC0HA" class="Code">device = gbm_create_device(drm_fd);</div><div id="wwpID0E0DC0HA" class="Code">bo = gbm_bo_create_with_modifiers(device, width, height,</div><div id="wwpID0E0CC0HA" class="Code">                                  format, modifiers, modifiers_count);</div><div id="wwpID0E0BC0HA" class="Body_Text">Weston supports the formats <span class="Code_Char">DRM_FORMAT_XRGB8888</span> and <span class="Code_Char">DRM_FORMAT_ARGB8888</span>.</div><div id="wwpID0E0AC0HA" class="Body_Text">A <span class="Strong">modifier</span> is an encoding of vendor-specific buffer layout parameters. Weston supports modifiers are supported by DRM (read the <span class="Code_Char">IN_FORMATS</span> plane property blob) and by EGL (call <span class="Code_Char">eglQueryDmaBufModifiersEXT()</span>&nbsp;).</div><H4 id="wwpID0E06B0HA" class="Heading_4">Buffer Write/read from CPU</H4><div id="wwpID0E05B0HA" class="Body_Text">You can use this API function to write data directly into a GBM buffer:</div><div id="wwpID0E04B0HA" class="Code">gbm_bo_write(bo, user_buffer, sizeof user_buffer);</div><div id="wwpID0E03B0HA" class="Body_Text">You also can memory map a GBM buffer and get a CPU-accessible address to the data written to or read from it. The following code snippet shows how:</div><div id="wwpID0E02B0HA" class="Code">uint32_t dst_stride = 0;</div><div id="wwpID0E01B0HA" class="Code">void *gbo_mapping = NULL;</div><div id="wwpID0E0ZB0HA" class="Code">// Map bo to CPU accessible address.</div><div id="wwpID0E0YB0HA" class="Code">char *dst_ptr = gbm_bo_map(bo,</div><div id="wwpID0E0XB0HA" class="Code">                           0, 0,</div><div id="wwpID0E0WB0HA" class="Code">                           width,</div><div id="wwpID0E0VB0HA" class="Code">                           height,</div><div id="wwpID0E0UB0HA" class="Code">                           GBM_BO_TRANSFER_READ_WRITE,</div><div id="wwpID0E0TB0HA" class="Code">                           &amp;dst_stride,</div><div id="wwpID0E0SB0HA" class="Code">                           &amp;gbo_mapping);</div><div id="wwpID0E0RB0HA" class="Code">&nbsp;</div><div id="wwpID0E0QB0HA" class="Code">// Write data to or read data from dst_ptr.</div><div id="wwpID0E0PB0HA" class="Code">. . .</div><div id="wwpID0E0OB0HA" class="Code">&nbsp;</div><div id="wwpID0E0NB0HA" class="Code">// Unmap bo.</div><div id="wwpID0E0MB0HA" class="Code">gbm_bo_unmap(bo, gbo_mapping);</div><H4 id="wwpID0E0LB0HA" class="Heading_4">Wayland Protocol to Post dma-buf Buffers to Weston</H4><div id="wwpID0E0KB0HA" class="Body_Text">Weston uses the Generic Buffer Management&nbsp;(GBM)&nbsp;library to allocate buffers,&nbsp;which are backed by&nbsp;dma-buf file descriptors. Client applications must call the following GBM functions to get the dma-buf file descriptor and associated parameters from the GBM buffer object. To post the dma-buf to a Wayland surface, the file descriptor and parameters must be provided via Linux DMA-BUF Unstable V1 Protocol.</div><div id="wwpID0E0JB0HA" class="Body_Text">The following code snippet shows the main calls involved.</div><div id="wwpID0E0IB0HA" class="Code">stride = gbm_bo_get_stride_for_plane(bo, 0);</div><div id="wwpID0E0HB0HA" class="Code">offset = gbm_bo_get_offset(bo, 0);</div><div id="wwpID0E0GB0HA" class="Code">handle = gbm_bo_get_handle_for_plane(bo, 0);</div><div id="wwpID0E0FB0HA" class="Code">modifier = gbm_bo_get_modifier(bo);</div><div id="wwpID0E0EB0HA" class="Code">drmPrimeHandleToFD(drm_fd, handle, 0, &amp;dmabuf_fd);</div><div id="wwpID0E0DB0HA" class="Code">&nbsp;</div><div id="wwpID0E0CB0HA" class="Code">zwp_linux_buffer_params_v1_add(params, dmabuf_fds, 0, offset,</div><div id="wwpID0E0BB0HA" class="Code">                               stride, modifier &gt;&gt; 32,</div><div id="wwpID0E0AB0HA" class="Code">                               modifier &amp; 0xffffffff);</div><div id="wwpID0E6HA" class="Code">zwp_linux_buffer_params_v1_create(params, width, height,</div><div id="wwpID0E5HA" class="Code">                                  format, flags);</div><H4 id="wwpID0E4HA" class="Heading_4">GL Renderer in Weston</H4><div id="wwpID0E3HA" class="Body_Text">The GL renderer in Weston creates an <span class="Code_Char">eglImage</span> from a dma-buf object that it receives with Linux DMA-BUF Unstable V1 Protocol using the <span class="Code_Char">EGL_EXT_image_dma_buf_import</span> and <span class="Code_Char">EGL_EXT_image_dma_buf_import_modifiers</span> extensions. Weston obtains the GL texture target to be used with this <span class="Code_Char">eglImage</span> by calling <span class="Code_Char">eglQueryDmaBufModifiersEXT()</span>, and binds the <span class="Code_Char">eglImage</span> to the texture.</div><H4 id="wwpID0E2HA" class="Heading_4">Display Hardware Compositing in Weston</H4><div id="wwpID0E1HA" class="Body_Text">The DRM compositor in Weston calls <span class="Code_Char">drmModeAddFB2WithModifiers()</span> to associate a DRM framebuffer ID with the&nbsp;dma-buf it receives via&nbsp;Linux DMA-BUF Unstable V1 Protocol. It then uses&nbsp;the framebuffer ID to present the dma-buf to one of the available display hardware planes using <span class="Code_Char">drmModeSetPlane()</span>,&nbsp;in the legacy path,&nbsp;or <span class="Code_Char">drmModeAtomicCommit()</span>, in the atomic modeset path. This takes the form of a flip, where the reference to the new buffer is swapped in&nbsp;during vblank.</div><H3 id="wwpID0EZHA" class="Heading_3">weston-debug</H3><div id="wwpID0EYHA" class="Body_Text">The client application <span class="Code_Char">weston-debug</span> receives and prints debug messages using the weston-debug protocol. For example, when Weston is recompositing it prints all surface views and descriptions of the decision process regarding their assignment to overlays and GL compositing.</div><div id="wwpID0EXHA" class="Body_Text">For <span class="Code_Char">weston-debug</span> to work, you must run Weston with the <span class="Code_Char">‑‑debug</span> switch. Do not use this switch in production.</div><div id="wwpID0EWHA" class="Body_Text">You can pass <span class="Code_Char">weston-debug</span> additional parameters to choose categories of debug output to display:1</div><div id="wwpID0EVHA" class="Code">$ sudo XDG_RUNTIME_DIR=/tmp/xdg weston –debug</div><div id="wwpID0EUHA" class="Code">$ sudo XDG_RUNTIME_DIR=/tmp/xdg ./weston-debug -a</div><div id="wwpID0ETHA" class="Body_Text">Alternatively, you can enable Weston debug output by setting the environment variable <span class="Code_Char">WAYLAND_DEBUG=server</span>, and Weston client debug by setting <span class="Code_Char">WAYLAND_DEBUG=1</span>.</div></div><div id="page_dates"></div><!-- Related Topics --><!--                --><footer><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br /></footer></div></div><input type="hidden" id="preserve_unknown_file_links" value="false"></input><noscript><div id="noscript_warning">This site works best with JavaScript enabled</div></noscript><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></body></html>